function MainAssistant(a){this.MapCookie=a.Cookies.MapCookie;this.TrafficCookie=a.Cookies.TrafficCookie;this.PrefsCookie=a.Cookies.PrefsCookie;this.launchParams=a.launchParams}var markers=[],infoBubbles=[],Favorites=[],MarkersArray=[],db=new Mojo.Depot({name:"MainDB",version:1,replace:!1},function(){},function(a){Mojo.Log.error("MainDB",a.message)});
MainAssistant.prototype={setup:function(){this.cevent=[];this.cevent.magHeading=0;(this.devfakegps=this.debug=this.devversion=!1)||this.checkConnectivity();this.controller.setupWidget("DirectionsPanelScroller",this.attributes={mode:"vertical"},this.DirectionsPanelScrollerModel={snapElements:{x:[]}});if(this.isTouchPad()){var a=Math.round(0.84*this.controller.window.innerHeight)+"px";document.getElementById("DirectionsPanelScroller").style.maxHeight="620px";this.optimizedmarkers=!0}else a=Math.round(0.75*
this.controller.window.innerHeight)+"px",document.getElementById("DirectionsPanelScroller").style.maxHeight=a,this.optimizedmarkers=!1;this.touch="ontouchstart"in document.documentElement?!0:!1;this.Log("**** Touch enable webkit: %j",this.touch);this.controller.setupWidget("DirectType",this.attributes={choices:[{label:$L(""),value:"driving"},{label:$L(""),value:"walking"},{label:$L(""),value:"transit"},{label:$L(""),value:"bicycling"}]},this.model={value:"driving",disabled:!1});this.DirectTypeEventHandler=
this.DirectType.bindAsEventListener(this);this.DirectType=this.controller.get("DirectType");Mojo.Event.listen(this.DirectType,Mojo.Event.propertyChange,this.DirectTypeEventHandler);this.controller.setupWidget("TimePickerRadio",this.attributes={choices:[{label:$L("Departure"),value:"departure"},{label:$L("Arrival"),value:"arrival"}]},this.TimePickerRadioModel={value:"departure",disabled:!1});this.TimePickerRadioEventHandler=this.TimePickerRadio.bindAsEventListener(this);this.TimePickerRadio=this.controller.get("TimePickerRadio");
Mojo.Event.listen(this.TimePickerRadio,Mojo.Event.propertyChange,this.TimePickerRadioEventHandler);this.TransitDateFieldEventHandler=this.pickDateKalendae.bindAsEventListener(this);this.TransitDateField=this.controller.get("TransitDateField");this.TransitDateField.observe(Mojo.Event.tap,this.TransitDateFieldEventHandler);this.kalendae=new Kalendae("Kalendae",{months:1,mode:"single",weekStart:1,direction:"today-future",selected:new Date});this.kalendae.subscribe("change",this.handleKalendaeDate.bind(this));
$("TransitDateField").innerHTML=$L("Today");var c=new Date;this.controller.setupWidget("KalendaeDrawer",this.attributes={modelProperty:"open",unstyled:!0},this.KalendaeDrawerModel={open:!1});this.controller.setupWidget("TransitTime",this.attributes={label:$L("Time"),modelProperty:"time"},this.TransitDateModel={time:c});this.TransitPickerEventHandler=this.TransitPicker.bindAsEventListener(this);this.TransitTimePicker=this.controller.get("TransitTime");Mojo.Event.listen(this.TransitTimePicker,Mojo.Event.propertyChange,
this.TransitPickerEventHandler);this.avoidTolls=this.avoidHighways=this.routeAlternatives=!1;this.controller.setupWidget("RouteAlternatives",this.attributes={trueValue:!0,falseValue:!1},this.RouteAlternativesModel={value:this.routeAlternatives,disabled:!1});this.RouteAlternativesHandler=this.handleRouteAlternatives.bindAsEventListener(this);Mojo.Event.listen(this.controller.get("RouteAlternatives"),Mojo.Event.propertyChange,this.RouteAlternativesHandler);this.controller.setupWidget("AvoidHighways",
this.attributes={trueValue:!0,falseValue:!1},this.AvoidHighwaysModel={value:this.avoidHighways,disabled:!1});this.AvoidHighwaysHandler=this.handleAvoidHighways.bindAsEventListener(this);Mojo.Event.listen(this.controller.get("AvoidHighways"),Mojo.Event.propertyChange,this.AvoidHighwaysHandler);this.controller.setupWidget("AvoidTolls",this.attributes={trueValue:!0,falseValue:!1},this.AvoidTollsModel={value:this.avoidTolls,disabled:!1});this.AvoidTollsHandler=this.handleAvoidTolls.bindAsEventListener(this);
Mojo.Event.listen(this.controller.get("AvoidTolls"),Mojo.Event.propertyChange,this.AvoidTollsHandler);this.controller.setupWidget("DirectionsOptionsScroller",this.attributes={mode:"vertical"},this.DirectionsOptionsScrollerModel={snapElements:{x:[]}});document.getElementById("DirectionsOptionsScroller").style.maxHeight=a;this.controller.setupWidget("GetDirectionsButton",this.attributes={},this.DirectionsButtonModel={label:$L("Get Directions >"),disabled:!1});this.GetDirectionsButtonEventHandler=this.GetDirectionsButtonTap.bindAsEventListener(this);
this.GetDirectionsButton=this.controller.get("GetDirectionsButton");Mojo.Event.listen(this.GetDirectionsButton,Mojo.Event.tap,this.GetDirectionsButtonEventHandler);this.OriginMarkersButtonEventHandler=this.OriginMarkersButtonTap.bindAsEventListener(this);this.OriginMarkersButton=this.controller.get("OriginMarkersButton");Mojo.Event.listen(this.OriginMarkersButton,Mojo.Event.tap,this.OriginMarkersButtonEventHandler);this.DestinationMarkersButtonEventHandler=this.DestinationMarkersButtonTap.bindAsEventListener(this);
this.DestinationMarkersButton=this.controller.get("DestinationMarkersButton");Mojo.Event.listen(this.DestinationMarkersButton,Mojo.Event.tap,this.DestinationMarkersButtonEventHandler);this.MapHoldEventHandler=this.MapHold.bindAsEventListener(this);this.MapHold=this.controller.get("map_canvas");Mojo.Event.listen(this.MapHold,Mojo.Event.hold,this.MapHoldEventHandler);this.MapTapEventHandler=this.MapTap.bindAsEventListener(this);this.MapTap=this.controller.get("map_canvas");this.mousedownInterruptsFollowHandler=
this.mousedownInterruptsFollow.bindAsEventListener(this);this.panMousedownHandler=this.panMousedown.bindAsEventListener(this);this.controller.setupWidget("TPBackButton",this.attributes={},this.BackButtonModel={label:$L("Back"),disabled:!1});this.TPBackButtonEventHandler=this.handleBackSwipe.bindAsEventListener(this);this.TPBackButton=this.controller.get("TPBackButton");Mojo.Event.listen(this.TPBackButton,Mojo.Event.tap,this.TPBackButtonEventHandler);this.controller.setupWidget("TPBackButtonD",this.attributes=
{},this.BackButtonModel);this.TPBackButtonD=this.controller.get("TPBackButtonD");Mojo.Event.listen(this.TPBackButtonD,Mojo.Event.tap,this.TPBackButtonEventHandler);this.controller.setupWidget("LoadingSpinner",this.attributes={spinnerSize:"large"},this.LoadApiModel={spinning:!0});this.controller.setupWidget("StatusPanelSpinner",this.attributes={spinnerSize:"small"},this.StatusPanelSpinnerModel={spinning:!0});this.SwapDirectionsHandler=this.SwapDirections.bindAsEventListener(this);this.controller.get("SwapButton").observe(Mojo.Event.tap,
this.SwapDirectionsHandler);this.setLocalizedHTML();this.setStatusPanel($L("Loading Maps..."));this.devversion&&$("devlabel").show();this.firstGPSfix();this.setStatusPanel($L("Waiting for your location..."));this.heightadd=this.widthadd=110;this.ImageRatio=1;this.ImagePathAdd="";this.ScreenRoughRatio=this.controller.window.devicePixelRatio;this.isPre3()?(this.Log("*** Detected device is Pre3 ***"),this.widthadd=272,this.heightadd=380,this.ImageRatio=1.5,this.ImagePathAdd="1.5/",this.restmenuwidth=
Mojo.Environment.DeviceInfo.screenWidth-this.widthadd):this.restmenuwidth=this.controller.window.innerWidth-this.widthadd;this.createMenu();this.GPSFix=!1;this.geocoder=new google.maps.Geocoder;this.MyLocation=new google.maps.LatLng(37.39281,-122.04046199999999);this.MapOffStyle=[{featureType:"all",elementType:"all",stylers:[{visibility:"off"}]}];this.mapStyleNight=[[{stylers:[{saturation:-73},{visibility:"simplified"}]}],[{featureType:"road",stylers:[{hue:"#dd00ff"}]},{featureType:"water",stylers:[{hue:"#00f6ff"},
{lightness:-18},{saturation:62}]},{featureType:"landscape",stylers:[{hue:"#ffc300"},{saturation:63},{lightness:-16}]}],[{elementType:"geometry",stylers:[{gamma:3.16}]},{featureType:"transit",stylers:[{visibility:"on"},{hue:"#ff0008"},{saturation:95},{lightness:-40}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{saturation:59},{lightness:-8}]}],[{stylers:[{invert_lightness:!0}]}]];this.Log("*************************************");this.Log("* GOOGLE MAPS API VERSION: ",
google.maps.version);this.Log("*************************************");a={zoom:2,center:this.MyLocation,mapTypeId:google.maps.MapTypeId.ROADMAP,disableDefaultUI:!0,scaleControl:!0,rotateControl:!1,maxZoom:this.maxZoom,minZoom:this.minZoom,mapMaker:!1,keyboardShortcuts:!1,draggable:!1};this.map=new google.maps.Map(this.controller.get("map_canvas"),a);this.MapType=this.MapCookie.get();if(void 0==this.MapType)this.ActualMapType=[!0,!1,!1,!1],this.Log("DEFAULT:",this.MapType);else{this.Log("Cookie MapType:",
this.MapType);try{this.handlePopMapType(this.MapType)}catch(d){this.Log("Layers cookie not properly defined, revert to default",d),this.MapCookie.remove(),this.MapType="Roadmap",this.MapCookie.put(this.MapType),this.handlePopMapType(this.MapType)}}this.overlay=new google.maps.OverlayView;this.overlay.draw=function(){};this.overlay.setMap(this.map);this.Preferences=this.PrefsCookie.get();this.Log("PREFERENCES: %j",this.Preferences);if(void 0==this.Preferences)this.Preferences=DefaultPreferences,this.PrefsCookie.put(this.Preferences);
else try{this.checkAllPreferences(this.Preferences)}catch(f){this.Log("Preferences not properly defined, revert to default",f),this.PrefsCookie.remove(),this.Preferences=DefaultPreferences,this.PrefsCookie.put(this.Preferences)}this.controller.enableFullScreenMode(this.Preferences.Fullscreen);this.getFavorites();this.Preferences.MapCache?this.map.mapTypes.set("OSM",new OSMMapType(this.Preferences)):this.map.mapTypes.set("OSM",new google.maps.ImageMapType({getTileUrl:function(a,c){return"http://tile.openstreetmap.org/"+
c+"/"+a.x+"/"+a.y+".png"},tileSize:new google.maps.Size(256,256),isPng:!0,name:"OpenStreetMap",credit:"OpenStreetMap",maxZoom:18}));this.map.mapTypes.set("NOKIA",new google.maps.ImageMapType({getTileUrl:function(a,c){return"http://maptile.maps.svc.ovi.com/maptiler/maptile/newest/normal.day/"+c+"/"+a.x+"/"+a.y+"/256/png8"},tileSize:new google.maps.Size(256,256),isPng:!0,maxZoom:17,name:"NOKIA"}));this.map.mapTypes.set("ROADMAP_HDPI",new google.maps.ImageMapType({getTileUrl:function(a,c){return"http://mts0.google.com/vt?lyrs=m@216000000,seconds_into_week:-1&x="+
a.x+"&y="+a.y+"&z="+c+"&style=2"},tileSize:new google.maps.Size(256,256),isPng:!0,maxZoom:17,name:"ROADMAP_HDPI"}));this.MainInput="";this.MainInput=document.getElementById("MainSearchField");this.MainAutocomplete=new google.maps.places.SearchBox(this.MainInput);this.MainAutocomplete.bindTo("bounds",this.map);new google.maps.event.addListener(this.MainAutocomplete,"places_changed",this.SelectedAutocomplete.bind(this));this.OriginInput="";this.OriginInput=document.getElementById("OriginSearchField");
this.Originautocomplete=new google.maps.places.Autocomplete(this.OriginInput);this.Originautocomplete.bindTo("bounds",this.map);new google.maps.event.addListener(this.Originautocomplete,"place_changed",this.SelectedOriginPlace.bind(this));this.DestinationInput="";this.DestinationInput=document.getElementById("DestinationSearchField");this.Destinationautocomplete=new google.maps.places.Autocomplete(this.DestinationInput);this.Destinationautocomplete.bindTo("bounds",this.map);new google.maps.event.addListener(this.Destinationautocomplete,
"place_changed",this.SelectedDestinationPlace.bind(this));this.DirectinfoBubbles=[];this.Directmarkers=[];this.DirectStep=0;this.NearbyinfoBubbles=[];this.Nearbymarkers=[];this.NearbyStep=0;this.blockGPSFix=this.isNavit=this.wasflicked=this.blockTPPan=!1;this.mapcanvasy=this.mapcanvasx=0;this.blockpulse=this.compassactive=this.haveCompass=!1;this.imageryHeading=this.imagery=this.routeIndex=0;this.cmdMenuStyle="normal";this.maxZoom=20;this.minZoom=0;this.dontForgetToEnableZoomOut=this.dontForgetToEnableZoomIn=
!1;this.gps;this.parsedParams=null;this.idleNeedleDeg=this.idleCompassDeg=0;this.kineting=!1;this.trickTime=100;this.OSMPrefix="http://tile.openstreetmap.org/";this.existsCache=[];this.refreshTimerCounting=!1;this.NewTilesHere=!0;this.followMap=!1;a={map:this.map,suppressMarkers:!0,polylineOptions:{clickable:!1,strokeColor:"#4941e3",strokeOpacity:0.7,strokeWeight:8*this.ScreenRoughRatio},markerOptions:{optimized:this.optimizedmarkers},suppressInfoWindows:!0,draggable:!1};this.directionsService=new google.maps.DirectionsService;
this.directionsDisplay=new google.maps.DirectionsRenderer(a);this.directionsDisplay.setPanel(document.getElementById("directions-panel"));this.trafficLayer=new google.maps.TrafficLayer;this.TrafficVisibile=this.TrafficCookie.get();this.Log("TRAFFIC:",this.TrafficVisibile);if(void 0==this.TrafficVisibile)this.TrafficVisibile=!1,this.TrafficCookie.put(!0);else try{this.Traffic()}catch(g){this.Log("Cookie not properly defined, revert to default",g),this.TrafficCookie.remove(),this.TrafficCookie.put(!1),
this.TrafficVisibile=!1}this.bikeLayer=new google.maps.BicyclingLayer;(this.BikeVisibile=this.Preferences.Bike)&&this.bikeLayer.setMap(this.map);this.weatherLayer=new google.maps.weather.WeatherLayer({suppressInfoWindows:!0});(this.WeatherVisibile=this.Preferences.Weather)&&this.weatherLayer.setMap(this.map);this.cloudLayer=new google.maps.weather.CloudLayer;(this.CloudVisibile=this.Preferences.Cloud)&&this.cloudLayer.setMap(this.map);(this.NightVisibile=this.Preferences.Night)&&this.map.setOptions({styles:this.mapStyleNight[3]});
this.TransitVisibile=!1;a=new google.maps.LatLng(this.Preferences.LastLoc.lat,this.Preferences.LastLoc.lng);this.map.setCenter(a);this.map.setZoom(this.Preferences.LastLoc.zoom);new google.maps.event.addListener(this.map,"idle",this.MapIdle.bind(this));new google.maps.event.addListener(this.map,"tilesloaded",this.MapTilesLoaded.bind(this));new google.maps.event.addListener(this.map,"bounds_changed",this.MapCenterChanged.bind(this));new google.maps.event.addListener(this.map,"overlaycomplete",this.OverlayComplete.bind(this));
new google.maps.event.addListener(this.map,"zoom_changed",this.zoomChanged.bind(this));this.CenterChanged=!0;new google.maps.event.addDomListener(document.getElementById("map_canvas"),"resize",this.Resize.bind(this));this.KeypresseventHandler=this.Keypress.bindAsEventListener(this);this.debug||this.controller.listen(this.controller.stageController.document,"keydown",this.KeypresseventHandler);this.KeyWasPressed=!1;this.SearchKeypresseventHandler=this.SearchKeypress.bindAsEventListener(this);this.debug||
this.controller.listen(document.getElementById("MainSearchField"),"keydown",this.SearchKeypresseventHandler);this.SearchKeyWasPressed=!1;this.SearchPasteeventHandler=this.SearchPaste.bindAsEventListener(this);this.controller.listen(document.getElementById("MainSearchField"),"paste",this.SearchPasteeventHandler);Mojo.Event.listen(this.controller.get("map_canvas"),"gesturestart",this.handleGestureStart.bindAsEventListener(this));Mojo.Event.listen(this.controller.get("map_canvas"),"gesturechange",this.handleGestureChange.bindAsEventListener(this));
Mojo.Event.listen(this.controller.get("map_canvas"),"gestureend",this.handleGestureEnd.bindAsEventListener(this));this.DragStartEventHandler=this.dragStart.bindAsEventListener(this);this.DraggingEventHandler=this.dragging.bindAsEventListener(this);this.DragEndEventHandler=this.dragEnd.bindAsEventListener(this);this.FlickEventHandler=this.flick.bindAsEventListener(this);this.activateHandler=this.activateWindow.bind(this);Mojo.Event.listen(this.controller.stageController.document,Mojo.Event.stageActivate,
this.activateHandler);this.deactivateHandler=this.deactivateWindow.bind(this);Mojo.Event.listen(this.controller.stageController.document,Mojo.Event.stageDeactivate,this.deactivateHandler);this.compassHandler=this.compassHandler.bindAsEventListener(this);this.controller.listen(document,"compass",this.compassHandler);this.compassTapHandler=this.compassTap.bindAsEventListener(this);this.controller.listen($("compass"),Mojo.Event.tap,this.compassTapHandler);this.checkNavit()},handleCommand:function(a){a.type==
Mojo.Event.commandEnable&&(a.command==Mojo.Menu.helpCmd||a.command==Mojo.Menu.prefsCmd)&&a.stopPropagation();if(a.type===Mojo.Event.command){"zoomOut"==a.command&&this.zoom("out");"zoomIn"==a.command&&this.zoom("in");if("forward-step"==a.command||"back-step"==a.command)this.setStatusPanel($L("Moving to next point...")),this.moveOnRoute(a.command);if("maptype"==a.command){var c=a.originalEvent&&a.originalEvent.target;this.controller.popupSubmenu({onChoose:this.handlePopMapType,popupClass:"pre3maptype",
placeNear:c,items:[{secondaryIconPath:"images/maptype-roadmap.png",label:$L("Roadmap"),command:"Roadmap",chosen:this.ActualMapType[0]},{secondaryIconPath:"images/maptype-hybrid.png",label:$L("Hybrid"),command:"Hybrid",chosen:this.ActualMapType[1]},{secondaryIconPath:"images/maptype-terrain.png",label:$L("Terrain"),command:"Terrain",chosen:this.ActualMapType[2]},{secondaryIconPath:"images/maptype-satellite.png",label:$L("Satellite"),command:"Satellite",chosen:this.ActualMapType[3]},{secondaryIconPath:"images/traffic-icon.png",
label:$L("Traffic"),command:"do-traffic",chosen:this.TrafficVisibile},{secondaryIconPath:"images/map-bubble-arrow-blue.png",label:$L("More")+" ...",command:"do-more",chosen:!1}]})}"do-about"==a.command&&this.controller.stageController.pushScene({name:"about"});"do-license"==a.command&&this.controller.stageController.pushScene({name:"license"});"searchPlaces"==a.command&&this.Search();"debug"==a.command&&this.Debug();"imagery-rotate"==a.command&&this.ImageryRotate();"MyLoc"==a.command&&this.mylocation();
"PopMenu"==a.command&&(this.NearLayerTap=c=a.originalEvent&&a.originalEvent.target,this.Preferences.Fullscreen?this.controller.popupSubmenu({onChoose:this.handlePopMenu,popupClass:"pre3menu",placeNear:c,items:[{iconPath:"images/exit-fullscreen.png",label:$L("Exit Fullscreen"),command:"do-fullscreenoff"},{iconPath:"images/markers-icon.png",label:$L("Markers"),command:"do-markers"},{iconPath:"images/direction-icon.png",label:$L("Directions"),command:"do-direct"},{iconPath:"images/street.png",label:$L("Street View"),
command:"do-street"},{iconPath:"images/clear-map.png",label:$L("Clear map"),command:"do-clearmap"}]}):this.controller.popupSubmenu({onChoose:this.handlePopMenu,popupClass:"pre3menu",placeNear:c,items:[{iconPath:"images/exit-fullscreen.png",label:$L("Go Fullscreen"),command:"do-fullscreenon"},{iconPath:"images/markers-icon.png",label:$L("Markers"),command:"do-markers"},{iconPath:"images/direction-icon.png",label:$L("Directions"),command:"do-direct"},{iconPath:"images/street.png",label:$L("Street View"),
command:"do-street"},{iconPath:"images/clear-map.png",label:$L("Clear map"),command:"do-clearmap"}]}));"searchDone"==a.command&&this.zoom();a.command==Mojo.Menu.prefsCmd&&this.controller.stageController.pushScene({name:"preferences"},this.PrefsCookie)}a.type==Mojo.Event.back&&this.handleBackSwipe(a);a.type==Mojo.Event.forward&&this.handleForwardSwipe(a)},cleanup:function(){this.stopTracking();this.Preferences.LastLoc.lat=this.map.getCenter().lat();this.Preferences.LastLoc.lng=this.map.getCenter().lng();
this.Preferences.LastLoc.zoom=this.map.getZoom();this.PrefsCookie.put(this.Preferences);Mojo.Event.stopListening(this.controller.get("map_canvas"),"gesturestart",this.handleGestureStart.bind(this));Mojo.Event.stopListening(this.controller.get("map_canvas"),"gesturechange",this.handleGestureChange.bind(this));Mojo.Event.stopListening(this.controller.get("map_canvas"),"gestureend",this.handleGestureEnd.bind(this));Mojo.Event.stopListening(this.controller.get("map_canvas"),"mousedown",this.mousedownHandler.bind(this));
Mojo.Event.stopListening(this.controller.get("map_canvas"),"click",this.click.bind(this));Mojo.Event.stopListening(this.controller.sceneElement,Mojo.Event.keydown,this.KeypresseventHandler);this.WebOS2Events("stop");Mojo.Event.stopListening(this.DirectType,Mojo.Event.propertyChange,this.DirectTypeEventHandler);Mojo.Event.stopListening(this.GetDirectionsButton,Mojo.Event.tap,this.GetDirectionsButtonEventHandler);Mojo.Event.stopListening(this.TPBackButton,Mojo.Event.tap,this.TPBackButtonEventHandler);
Mojo.Event.stopListening(this.TPBackButtonD,Mojo.Event.tap,this.TPBackButtonEventHandler);Mojo.Event.stopListening(this.OriginMarkersButton,Mojo.Event.tap,this.OriginMarkersButtonEventHandler);Mojo.Event.stopListening(this.DestinationMarkersButton,Mojo.Event.tap,this.DestinationMarkersButtonEventHandler);Mojo.Event.stopListening(this.MapHold,Mojo.Event.hold,this.MapHoldEventHandler);Mojo.Event.stopListening(this.MapTap,Mojo.Event.tap,this.MapTapEventHandler);Mojo.Event.stopListening(this.TimePickerRadio,
Mojo.Event.propertyChange,this.TimePickerRadioEventHandler);this.TransitDateField.stopObserving(Mojo.Event.tap,this.TransitDateFieldEventHandler);Mojo.Event.stopListening(this.TransitTimePicker,Mojo.Event.propertyChange,this.TransitPickerEventHandler);Mojo.Event.stopListening(this.controller.get("RouteAlternatives"),Mojo.Event.propertyChange,this.RouteAlternativesHandler);Mojo.Event.stopListening(this.controller.get("AvoidHighways"),Mojo.Event.propertyChange,this.AvoidHighwaysHandler);Mojo.Event.stopListening(this.controller.get("AvoidTolls"),
Mojo.Event.propertyChange,this.AvoidTollsHandler)},createMenu:function(){this.isTouchPad()&&($("TPBackButton").show(),$("TPBackButtonD").show(),this.actualTPwidth=this.controller.window.innerWidth);this.cmdMenuModel={visible:!0,items:[{items:[]},{items:[{label:$L("Minus"),iconPath:"images/zoomout.png",command:"zoomOut"},{label:$L(""),iconPath:"images/list-view-icon.png",command:"PopMenu"},{label:$L("Plus"),iconPath:"images/zoomin.png",command:"zoomIn"}]},{items:[]}]};this.controller.setupWidget(Mojo.Menu.commandMenu,
{menuClass:"bottom-menu"},this.cmdMenuModel);this.CmdMenuHoldHandler=this.handleCmdMenuHold.bindAsEventListener(this);Mojo.Event.listen(document.body,Mojo.Event.hold,this.CmdMenuHoldHandler);this.appMenuModel={items:[{label:$L("About..."),command:"do-about",shortcut:"a"},{label:$L("License"),command:"do-license",shortcut:"l"}]};this.controller.setupWidget(Mojo.Menu.appMenu,{omitDefaultItems:!1},this.appMenuModel);this.feedMenuModel={visible:!0,items:[{items:[]},{items:[{},{label:$L("Google Maps"),
command:"searchPlaces",width:this.restmenuwidth},{iconPath:"images/layers.png",command:"maptype",label:$L("M")},{label:$L("MyLoc"),iconPath:"images/menu-icon-mylocation.png",command:"MyLoc",disabled:!0},{}]},{items:[]}]};this.controller.setupWidget(Mojo.Menu.viewMenu,{spacerHeight:0,menuClass:"top-menu"},this.feedMenuModel)},firstFixSuccess:function(a){var c=new google.maps.LatLng(a.latitude,a.longitude);void 0!=a.latitude?(this.Log("** FIRST GPS FIX ***"),this.gps=a,this.MyLocation=c,this.accuracy=
a.horizAccuracy,0>this.accuracy&&(this.accuracy=350),this.circle=new google.maps.Circle({center:this.MyLocation,radius:this.accuracy,map:this.map,optimized:this.optimizedmarkers,fillColor:"#60bbe5",fillOpacity:0.1,strokeColor:"#60bbe5",strokeOpacity:0.4,strokeWeight:1}),this.MyLocMarker=new google.maps.Marker({position:this.MyLocation,map:this.map,optimized:this.optimizedmarkers,flat:!0,title:"My Location"}),this.setDefaultMyLocMarker(),this.circle.bindTo("center",this.MyLocMarker,"position"),this.GPSFix=
!0,this.map.setCenter(this.MyLocation),this.feedMenuModel.items[1].items[3].disabled=!1,this.controller.modelChanged(this.feedMenuModel),void 0==this.maploc&&(this.map.fitBounds(this.circle.getBounds()),14<this.map.getZoom()&&this.map.setZoom(14)),this.startTracking()):this.firstGPSfix()},gpsUpdate:function(a){var c=new google.maps.LatLng(a.latitude,a.longitude);if(void 0!=a.latitude&&void 0!=a.longitude&&!this.blockGPSFix){this.gps=a;this.devfakegps&&(a.heading=this.devpreviousheading,void 0!=this.MyLocation&&
(this.Heading=this.GetHeadingFromLatLng(this.MyLocation,c),0!=this.Heading?this.devpreviousheading=a.heading=this.Heading:a.heading=this.devpreviousheading),a.velocity=google.maps.geometry.spherical.computeDistanceBetween(this.MyLocation,c));this.MyLocation=c;this.followMap?(this.map.panTo(this.MyLocation),0.5<a.velocity?(c=this.getVelocityFromGPS(a.velocity),this.SetTopMenuText(c)):this.SetTopMenuText($L("Google Maps"))):this.pulseDot(this.MyLocation);this.accuracy=a.horizAccuracy;0>this.accuracy&&
(this.accuracy=500);try{this.MyLocMarker.setPosition(this.MyLocation)}catch(d){this.Log("Warning: MyLocMarker not defined")}this.accuracy!=this.oldaccuracy&&(this.circle.setRadius(this.accuracy),this.oldaccuracy=this.accuracy);-1!=a.heading&&(this.followMap&&0.83<a.velocity)&&(this.Preferences.MapRotate&&this.MapHeadingRotate(a),this.setScoutMarker(Math.round(a.heading)));-1!=a.heading&&0.55<a.velocity&&!this.followMap?this.setScoutMarker(Math.round(a.heading)):this.followMap||this.setDefaultMyLocMarker()}},
StreetView:function(a){this.setStatusPanel($L("Loading StreetView..."));this.WebOS2Events("stop");a||(a=this.map.getCenter());this.controller.stageController.pushScene({name:"street",disableSceneScroller:!0,transition:Mojo.Transition.none},a)},zoom:function(a){switch(a){case "in":this.blockGPSFix=!0;this.setStatusPanel($L("Zooming in..."));this.map.setZoom(this.map.getZoom()+1);break;case "out":this.blockGPSFix=!0,this.setStatusPanel($L("Zooming out...")),this.map.setZoom(this.map.getZoom()-1)}},
zoomChanged:function(){if(this.TilesContainer){this.TilesContainer.style["-webkit-transform"]="scale(1,1)";for(var a=0;a<this.elementsToScale.length;a++)this.elementsToScale[a].style["-webkit-transform"]="scale(1,1)"}if(this.map.getZoom()>=this.maxZoom){for(a=0;a<this.cmdMenuModel.items[1].items.length;a++)this.cmdMenuModel.items[1].items[a].label==$L("Plus")&&(this.cmdMenuModel.items[1].items[a].disabled=!0);this.dontForgetToEnableZoomIn=!0;this.controller.modelChanged(this.cmdMenuModel)}else if(this.dontForgetToEnableZoomIn){for(a=
0;a<this.cmdMenuModel.items[1].items.length;a++)this.cmdMenuModel.items[1].items[a].label==$L("Plus")&&(this.cmdMenuModel.items[1].items[a].disabled=!1);this.dontForgetToEnableZoomIn=!1;this.controller.modelChanged(this.cmdMenuModel)}if(this.map.getZoom()<=this.minZoom){for(a=0;a<this.cmdMenuModel.items[1].items.length;a++)this.cmdMenuModel.items[1].items[a].label==$L("Minus")&&(this.cmdMenuModel.items[1].items[a].disabled=!0);this.dontForgetToEnableZoomOut=!0;this.controller.modelChanged(this.cmdMenuModel)}else if(this.dontForgetToEnableZoomOut){for(a=
0;a<this.cmdMenuModel.items[1].items.length;a++)this.cmdMenuModel.items[1].items[a].label==$L("Minus")&&(this.cmdMenuModel.items[1].items[a].disabled=!1);this.dontForgetToEnableZoomOut=!1;this.controller.modelChanged(this.cmdMenuModel)}},mylocation:function(){this.GPSFix?(this.setStatusPanel($L("Moving to My Location...")),this.BlockScreenTimeout(!0),this.feedMenuModel.items[1].items[3].iconPath="images/menu-icon-mylocation-follow.png",this.controller.modelChanged(this.feedMenuModel),this.getElementsToScale(),
this.followMap=this.NewTilesHere=!0,Mojo.Event.listen(this.controller.get("map_canvas"),"mousedown",this.mousedownInterruptsFollowHandler),this.map.setCenter(this.MyLocation),this.map.fitBounds(this.circle.getBounds()),16<this.map.getZoom()&&this.map.setZoom(16)):Mojo.Controller.errorDialog($L("Wait for GPS fix!"))},mousedownInterruptsFollow:function(){Mojo.Event.stopListening(this.controller.get("map_canvas"),"mousedown",this.mousedownInterruptsFollowHandler);var a=[];a.heading=0;a.velocity=0;this.MapHeadingRotate(a);
(function(){this.TilesContainer.style["-webkit-transition"]="";this.TilesContainer.style["-webkit-transform"]="";this.removeTransforms()}).bind(this).delay(1);this.followMap=!1;this.BlockScreenTimeout(!1);this.feedMenuModel.items[1].items[3].iconPath="images/menu-icon-mylocation.png";this.controller.modelChanged(this.feedMenuModel);this.SetTopMenuText($L("Google Maps"));this.compassRotate(this.idleCompassDeg)},BlockScreenTimeout:function(a){this.controller.stageController.setWindowProperties({blockScreenTimeout:a})},
handlePopMapType:function(a){switch(a){case "Roadmap":this.setStatusPanel($L("Setting map type: ")+$L("Roadmap"));this.map.setMapTypeId(google.maps.MapTypeId.ROADMAP);this.maxZoom=20;this.ClearMapType();this.ActualMapType[0]=!0;this.MapCookie.put(a);google.maps.event.trigger(this.map,"zoom_changed");break;case "Hybrid":this.setStatusPanel($L("Setting map type: ")+$L("Hybrid"));this.map.setMapTypeId(google.maps.MapTypeId.HYBRID);this.maxZoom=20;this.ClearMapType();this.ActualMapType[1]=!0;this.MapCookie.put(a);
google.maps.event.trigger(this.map,"zoom_changed");break;case "Terrain":this.setStatusPanel($L("Setting map type: ")+$L("Terrain"));this.map.setMapTypeId(google.maps.MapTypeId.TERRAIN);this.maxZoom=15;this.ClearMapType();this.ActualMapType[2]=!0;this.MapCookie.put(a);google.maps.event.trigger(this.map,"zoom_changed");break;case "Satellite":this.setStatusPanel($L("Setting map type: ")+$L("Satellite"));this.map.setMapTypeId(google.maps.MapTypeId.SATELLITE);this.maxZoom=20;this.ClearMapType();this.ActualMapType[3]=
!0;this.MapCookie.put(a);google.maps.event.trigger(this.map,"zoom_changed");break;case "do-traffic":this.Traffic();break;case "do-transit":this.Transit();break;case "do-bike":this.Bike();break;case "do-weather":this.Weather();break;case "do-cloud":this.Cloud();break;case "do-night":this.Night();break;case "do-osm":this.setStatusPanel($L("Setting map type: ")+$L("Openstreetmaps"));this.map.setMapTypeId("OSM");this.maxZoom=18;this.ClearMapType();this.ActualMapType[4]=!0;this.MapCookie.put(a);google.maps.event.trigger(this.map,
"zoom_changed");break;case "do-more":this.moreMapLayers()}},moreMapLayers:function(){this.controller.popupSubmenu({onChoose:this.handlePopMapType,popupClass:"pre3maptypemore",placeNear:null,items:[{secondaryIconPath:"images/OSMlogo.png",label:"OSM "+$L("map"),command:"do-osm",chosen:this.ActualMapType[4]},{secondaryIconPath:"images/night.png",label:$L("Night"),command:"do-night",chosen:this.NightVisibile},{secondaryIconPath:"images/transit.png",label:$L("Transit"),command:"do-transit",chosen:this.TransitVisibile},
{secondaryIconPath:"images/bike.png",label:$L("Bike"),command:"do-bike",chosen:this.BikeVisibile},{secondaryIconPath:"images/weather.png",label:$L("Weather"),command:"do-weather",chosen:this.WeatherVisibile},{secondaryIconPath:"images/cloud.png",label:$L("Clouds"),command:"do-cloud",chosen:this.CloudVisibile}]})},ClearMapType:function(){this.ActualMapType=[!1,!1,!1,!1]},handlePopMenu:function(a){switch(a){case "do-fullscreenoff":this.FullscreenOff(!0);break;case "do-fullscreenon":this.FullscreenOff(!1);
break;case "do-markers":this.getMarkerFromList("info");break;case "do-street":this.streetSelect();break;case "do-direct":this.Directions();break;case "do-clearmap":this.mapClear(),this.mapClear()}},activate:function(a){this.setViewPortWidth(480);this.blockGPSFix=!1;this.controller.listen(this.controller.stageController.document,"keydown",this.KeypresseventHandler);try{this.Preferences=this.PrefsCookie.get()}catch(c){this.Log("Preferences cookie not properly defined",c)}google.maps.event.trigger(this.map,
"resize");window.PalmSystem.enableFullScreenMode(this.Preferences.Fullscreen);this.launchParams&&(this.handleLaunch(this.launchParams),this.launchParams=null);this.WebOS2Events("start");if(void 0!=a)switch(a.action){case "info":this.map.setCenter(a.place.geometry.location);this.map.setZoom(17);this.blockTPPan=!0;(function(){this.blockTPPan=!1}).bind(this).delay(2);break;case "origin":this.setViewPortWidth(320);this.origin=a.place.geometry.location;""!=a.place.vicinity?this.controller.get("OriginSearchField").value=
a.place.name+", "+a.place.vicinity:this.controller.get("OriginSearchField").value=a.place.name;break;case "destination":this.setViewPortWidth(320);this.destination=a.place.geometry.location;""!=a.place.vicinity?this.controller.get("DestinationSearchField").value=a.place.name+", "+a.place.vicinity:this.controller.get("DestinationSearchField").value=a.place.name;break;case "updatefavorites":this.updateFavorites(a)}void 0!=this.bounds&&(this.map.fitBounds(this.bounds),this.bounds=null);!0==this.isTouchPad()&&
google.maps.event.trigger(this.map,"resize");this.updateMarkers();this.hideStatusPanel()},deactivate:function(){this.blockGPSFix=!0;this.setViewPortWidth(320);this.controller.stopListening(document,"compass",this.compassHandler)},updateFavorites:function(a){var c=a.markerindex;try{var d={url:markers[c].place.favorite?"images/"+this.ImagePathAdd+"Map-Marker-Push-Pin-2-Right-Red-icon-fav.png":"images/"+this.ImagePathAdd+"Map-Marker-Push-Pin-2-Right-Red-icon.png",size:new google.maps.Size(64*this.ImageRatio,
64*this.ImageRatio),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(31*this.ImageRatio,62*this.ImageRatio),scaledSize:new google.maps.Size(48*this.ImageRatio,48*this.ImageRatio)};markers[c].setIcon(d);infoBubbles[c].setContent('<div id="bubble" class="phoneytext">'+markers[c].place.name+'<div class="phoneytext2">'+markers[c].place.formatted_address+"</div></div>")}catch(f){a=this.getMarkerFromID(a.id);a.setMap(null);for(b=0;b<this.NearbyinfoBubbles.length;b++)this.NearbyinfoBubbles[b].close();
a.place.favorite=!0;this.PlaceMarker({position:a.place.geometry.location,title:a.place.name,subtitle:a.place.vicinity,place:a.place,icon:"Map-Marker-Push-Pin-2-Right-Red-icon-fav.png",popbubble:!0})}},getMarkerFromID:function(a){var c=null;for(e=0;e<markers.length;e++)markers[e].place.id==a&&(c=markers[e]);for(e=0;e<this.Nearbymarkers.length;e++)this.Nearbymarkers[e].place.id==a&&(c=this.Nearbymarkers[e]);return c},WebOS2Events:function(a){"2"==Mojo.Environment.DeviceInfo.platformVersionMajor&&"2"==
Mojo.Environment.DeviceInfo.platformVersionMinor&&(this.WebOS22=!0);switch(a){case "start":this.ListeningElement=this.controller.get("map_canvas");Mojo.Event.listen(this.ListeningElement,Mojo.Event.dragStart,this.DragStartEventHandler);Mojo.Event.listen(this.ListeningElement,Mojo.Event.dragging,this.DraggingEventHandler);Mojo.Event.listen(this.ListeningElement,Mojo.Event.dragEnd,this.DragEndEventHandler);Mojo.Event.listen(this.ListeningElement,Mojo.Event.flick,this.FlickEventHandler);Mojo.Event.listen(this.MapTap,
Mojo.Event.tap,this.MapTapEventHandler);break;case "stop":Mojo.Event.stopListening(this.ListeningElement,Mojo.Event.dragStart,this.DragStartEventHandler),Mojo.Event.stopListening(this.ListeningElement,Mojo.Event.dragging,this.DraggingEventHandler),Mojo.Event.stopListening(this.ListeningElement,Mojo.Event.dragEnd,this.DragEndEventHandler),Mojo.Event.stopListening(this.ListeningElement,Mojo.Event.flick,this.FlickEventHandler),Mojo.Event.stopListening(this.MapTap,Mojo.Event.tap,this.MapTapEventHandler)}},
WebOSVersion1:function(){return"1"==Mojo.Environment.DeviceInfo.platformVersionMajor?!0:!1},isTouchPad:function(){return-1<Mojo.Environment.DeviceInfo.modelNameAscii.indexOf("ouch")||1024==Mojo.Environment.DeviceInfo.screenWidth||1024==Mojo.Environment.DeviceInfo.screenHeight?!0:!1},isPre3:function(){return 800==Mojo.Environment.DeviceInfo.screenWidth||800==Mojo.Environment.DeviceInfo.screenHeight?!0:!1},gps1Failure:function(){this.GPSFix=!1},MapIdle:function(){this.wasflicked=!1;"main"==this.controller.stageController.activeScene().sceneName&&
(this.blockpulse=this.blockGPSFix=!1);this.LoadApiModel.spinning&&(this.LoadingSpinner("stop"),this.parsedParams&&(this.launchParamsAction(this.parsedParams),this.parsedParams=null));(function(){this.ActualCenter=this.map.getCenter();this.CenterChanged=!0}).bind(this).delay(1);this.hideStatusPanel();var a=this.map.getTilt();if(a!=this.imagery)switch(this.imagery=a,a){case 0:this.ChangeCmdMenu(this.cmdMenuStyle);this.imageryHeading=0;break;case 45:this.ChangeCmdMenu("imagery")}},MapTilesLoaded:function(){this.NewTilesHere=
!0;this.hideStatusPanel()},MapCenterChanged:function(){if(this.TilesContainer){this.touch||setTimeout(function(){this.MapScrimContainer.hide();this.TrickContainer.style.zIndex="9999";this.TrickContainer.innerHTML=""}.bind(this),this.trickTime);this.TilesContainer.style["-webkit-transform"]="";if(this.elementsToScale)for(var a=0;a<this.elementsToScale.length;a++)this.elementsToScale[a].style["-webkit-transform"]="";this.TilesContainer=null}this.CenterChanged=!0},hideCommandMenu:function(){this.controller.setMenuVisible(Mojo.Menu.commandMenu,
!1)},Resize:function(){if(this.isTouchPad()&&this.controller.window.innerWidth!=this.actualTPwidth){switch(this.controller.window.innerWidth){case 1024:this.orientationChanged("left");break;case 768:this.orientationChanged("up")}this.actualTPwidth=this.controller.window.innerWidth}else this.controller.window.innerWidth==this.actualTPwidth&&(!this.searching&&!this.directing&&!this.blockTPPan)&&(this.Log("** OTHER CHANGE ***"),this.blockTPPan=!1,function(){this.map.setCenter(this.ActualCenter)}.bind(this).delay(1))},
Traffic:function(){!1==this.TrafficVisibile?(this.setStatusPanel($L("Show")+" "+$L("Traffic")+"...",2),this.trafficLayer.setMap(this.map),this.TrafficVisibile=!0,this.TrafficCookie.put(!1)):(this.setStatusPanel($L("Hide")+" "+$L("Traffic")+"...",2),this.trafficLayer.setMap(null),this.TrafficVisibile=!1,this.TrafficCookie.put(!0))},Transit:function(){if(!1==this.TransitVisibile){this.setStatusPanel($L("Show")+" "+$L("Transit")+"...",2);var a={getTileUrl:function(a,d){return"http://mts0.googleapis.com/vt?lyrs=a,transit|seconds_into_week:-1&x="+
a.x+"&y="+a.y+"&z="+d+"&style=1"},tileSize:new google.maps.Size(256,256),isPng:!0},a=new google.maps.ImageMapType(a);this.map.overlayMapTypes.setAt(0,a);this.TransitVisibile=!0}else this.setStatusPanel($L("Hide")+" "+$L("Transit")+"...",2),this.map.overlayMapTypes.setAt(0,null),this.TransitVisibile=!1},Bike:function(){!1==this.BikeVisibile?(this.setStatusPanel($L("Show")+" "+$L("Bike")+"...",2),this.bikeLayer.setMap(this.map),this.BikeVisibile=!0,this.Preferences.Bike=!0):(this.setStatusPanel($L("Hide")+
" "+$L("Bike")+"...",2),this.bikeLayer.setMap(null),this.BikeVisibile=!1,this.Preferences.Bike=!1);this.PrefsCookie.put(this.Preferences)},Weather:function(){!1==this.WeatherVisibile?(this.setStatusPanel($L("Show")+" "+$L("Weather")+"...",2),this.weatherLayer.setOptions({temperatureUnits:this.getGoogleUnitSystem(this.Preferences.Temperature)}),this.weatherLayer.setMap(this.map),12<this.map.getZoom()&&this.map.setZoom(12),this.WeatherVisibile=!0,this.Preferences.Weather=!0):(this.setStatusPanel($L("Hide")+
" "+$L("Weather")+"...",2),this.weatherLayer.setMap(null),this.WeatherVisibile=!1,this.Preferences.Weather=!1);this.PrefsCookie.put(this.Preferences)},Cloud:function(){!1==this.CloudVisibile?(this.setStatusPanel($L("Show")+" "+$L("Clouds")+"...",2),this.cloudLayer.setMap(this.map),6<this.map.getZoom()&&this.map.setZoom(6),this.CloudVisibile=!0,this.Preferences.Cloud=!0):(this.setStatusPanel($L("Hide")+" "+$L("Clouds")+"...",2),this.cloudLayer.setMap(null),this.CloudVisibile=!1,this.Preferences.Cloud=
!1);this.PrefsCookie.put(this.Preferences)},Night:function(){var a;!1==this.NightVisibile?(a={styles:this.mapStyleNight[3]},this.setStatusPanel($L("Enable")+" "+$L("Night")+"...",2),this.map.setOptions(a),this.NightVisibile=!0,this.Preferences.Night=!0):(a={styles:null},this.setStatusPanel($L("Disable")+" "+$L("Night")+"...",2),this.map.setOptions(a),this.NightVisibile=!1,this.Preferences.Night=!1);this.PrefsCookie.put(this.Preferences)},fitBounds:function(a){this.bounds=a},handleGestureStart:function(a){this.blockGPSFix=
!0;this.setStatusPanel($L("Zooming..."));this.GestureCenter=this.map.getCenter();this.Zooming=!0;this.previouszoom=this.map.getZoom();this.previousScale=a.scale;this.previousS=0;$("pulse").hide();this.blockpulse=!0;this.oldeventg=a;this.TilesContainer=document.getElementById("map_canvas").firstChild.firstChild;this.TilesContainer.style.overflow="visible !important;";this.TilesContainer.style.position="absolute;";this.addpaneventg=[];this.addpaneventg.cx=0;this.addpaneventg.cy=0;this.addpaneventg.oldcenter=
this.overlay.getProjection().fromLatLngToContainerPixel(this.map.getCenter());this.getElementsToScale()},handleGestureChange:function(a){a.stop();this.TilesContainer.style["-webkit-transform"]="rotate3d(0,0,1,"+(0).toString()+"deg) scale("+a.scale+","+a.scale+") translate("+(-this.oldeventg.centerX+a.centerX)/a.scale+"px,"+(-this.oldeventg.centerY+a.centerY)/a.scale+"px)";this.addpaneventg.cx=this.addpaneventg.oldcenter.x+(this.oldeventg.centerX-a.centerX);this.addpaneventg.cy=this.addpaneventg.oldcenter.y+
(this.oldeventg.centerY-a.centerY);for(var c=0;c<this.elementsToScale.length;c++)this.elementsToScale[c].style["-webkit-transform"]="scale("+1/a.scale+","+1/a.scale+") rotate3d(0,0,1,"+(360).toString()+"deg) ";a=a.scale;0.187>=a&&(a=-3);0.187<a&&0.375>=a&&(a=-2);0.375<a&&0.75>=a&&(a=-1);0.75<a&&1.5>=a&&(a=0);1.5<a&&3>=a&&(a=1);3<a&&6>=a&&(a=2);6<a&&(a=3);this.previousS!=a&&(this.z=this.previouszoom+a,this.previousS=a)},handleGestureEnd:function(a){a.stop();this.TilesContainer.style["-webkit-transition"]=
"";this.doTrick();this.trickTime=1E3;this.map.setZoom(this.z);a=new google.maps.Point(this.addpaneventg.cx,this.addpaneventg.cy);this.map.setCenter(this.overlay.getProjection().fromContainerPixelToLatLng(a))},doTrick:function(){this.touch||(this.TrickContainer=document.getElementById("map_trick_canvas"),this.MapScrimContainer=document.getElementById("map_scrim"),this.TrickContainer.innerHTML=this.TilesContainer.innerHTML,this.TrickContainer.style["-webkit-transform"]=this.TilesContainer.style["-webkit-transform"],
this.TrickContainer.style.zIndex="10002",this.MapScrimContainer.show())},orientationChanged:function(a){if(this.isTouchPad())this.restmenuwidth="left"==a?Mojo.Environment.DeviceInfo.screenWidth-this.widthadd:Mojo.Environment.DeviceInfo.screenHeight-this.heightadd,function(){this.map.setCenter(this.ActualCenter)}.bind(this).delay(1);else switch(google.maps.event.trigger(this.map,"resize"),this.Log("Orientation changed to: ",a),this.restmenuwidth="right"===a||"left"===a?Mojo.Environment.DeviceInfo.screenHeight-
this.heightadd:Mojo.Environment.DeviceInfo.screenWidth-this.widthadd,this.map.setCenter(this.ActualCenter),this.updateDirectListHeight(),a){case "right":this.idleNeedleDeg=270;break;case "left":this.idleNeedleDeg=90;break;case "up":this.idleNeedleDeg=0;break;case "down":this.idleNeedleDeg=180}this.feedMenuModel.items[1].items[1].width=this.restmenuwidth;this.controller.modelChanged(this.feedMenuModel)},getGoogleTiles:function(){return this.TilesContainer=document.getElementById("map_canvas").firstChild.firstChild},
transformGoogleTiles:function(a){for(var c=0,d=this.imgcount;c<d;c++)this.imgchild[c].style.webkitTransform=a.action+"("+a.x+a.unit+","+a.y+a.unit+")"},getElementsByClass:function(a){var c,d,f;d=document.getElementsByTagName("*");f=[];for(var g=0;g<d.length;g++){c=d[g].className.split(" ");for(var h=0;h<c.length;h++)if(c[h]==a){f.push(d[g]);break}}return f},hideElementsByClass:function(a){for(var a=this.getElementsByClass(a),c=0;c<a.length;c++)a[c].parentNode.parentNode.hide()},showElementsByClass:function(a){for(var a=
this.getElementsByClass(a),c=0;c<a.length;c++)a[c].parentNode.parentNode.show()},dragStart:function(a){a.preventDefault();this.kineting=!1;this.trickTime=100;this.dragging||(this.blockGPSFix=this.dragging=!0,$("pulse").hide(),this.blockpulse=!0);this.oldevent?(this.oldevent.x+=a.down.x,this.oldevent.y+=a.down.y):this.oldevent=a.down;this.CenterChanged=!0;this.TilesContainer=document.getElementById("map_canvas").firstChild.firstChild;this.TilesContainer.style.overflow="visible !important;";this.addpanevent=
[];this.addpanevent.velocity=[];this.addpanevent.cx=0;this.addpanevent.cy=0;this.addpanevent.fx=0;this.addpanevent.fy=0;this.addpanevent.kx=0;this.addpanevent.ky=0;this.addpanevent.sx=0;this.addpanevent.sy=0;this.addpanevent.timestamp=Date.now();this.addpanevent.velocity.x=0;this.addpanevent.velocity.y=0;this.addpanevent.oldcenter=this.overlay.getProjection().fromLatLngToContainerPixel(this.map.getCenter());this.wasflicked=!1},dragging:function(a){a.preventDefault();this.TilesContainer||(this.TilesContainer=
document.getElementById("map_canvas").firstChild.firstChild);this.addpanevent.cx=this.addpanevent.oldcenter.x+this.oldevent.x-a.move.x;this.addpanevent.cy=this.addpanevent.oldcenter.y+this.oldevent.y-a.move.y;this.addpanevent.kx=-this.oldevent.x+a.move.x;this.addpanevent.ky=-this.oldevent.y+a.move.y;this.TilesContainer.style["-webkit-transform"]="translate("+this.addpanevent.kx+"px,"+this.addpanevent.ky+"px)";this.addpanevent.timestamp=(Date.now()+this.addpanevent.timestamp)/2},dragEnd:function(a){if(!this.wasflicked){var c=
Date.now()-this.addpanevent.timestamp;a.velocity=[];a.velocity.x=100*this.addpanevent.kx/c;a.velocity.y=100*this.addpanevent.ky/c;this.flick(a)}this.dragging=!1},flick:function(a){this.wasflicked=!0;var c=[];this.CenterChanged=!1;c.x=a.velocity.x/10;c.y=a.velocity.y/10;this.deltaconstX=c.x;this.deltaconstY=c.y;this.kineting=!0;this.dragging=!1;this.kineticMove(c);this.timeKinetic=50},click:function(){},kineticMove:function(a){(5<Math.abs(a.x)||5<Math.abs(a.y))&&!this.dragging?(this.moveContainer(this.timeKinetic,
a),this.kineting=!0,this.oldevent=null):this.dragging||(this.doTrick(),a=new google.maps.Point(this.addpanevent.cx,this.addpanevent.cy),this.setCenterTime=Date.now(),this.map.setCenter(this.overlay.getProjection().fromContainerPixelToLatLng(a)),this.oldevent=null,this.kineting=!1)},moveContainer:function(a,c){try{this.TilesContainer.style["-webkit-transform"]="translate("+(this.addpanevent.kx+(this.deltaconstX-c.x))+"px,"+(this.addpanevent.ky+(this.deltaconstY-c.y))+"px)"}catch(d){}this.addpanevent.cx=
this.addpanevent.oldcenter.x-(this.addpanevent.kx+(this.deltaconstX-c.x));this.addpanevent.cy=this.addpanevent.oldcenter.y-(this.addpanevent.ky+(this.deltaconstY-c.y));this.kineticTimer=setTimeout(function(){c.x/=1.6;c.y/=1.6;this.kineticMove(c)}.bind(this),a)},panMousedown:function(){var a=[];a.x=0;a.y=0;Mojo.Event.stopListening(this.controller.get("map_canvas"),"mousedown",this.panMousedownHandler);clearTimeout(this.kineticTimer);this.kineticMove(a)},mousedownHandler:function(){this.controller.setMenuVisible(Mojo.Menu.commandMenu,
!0);this.hideCommandMenu.bind(this).delay(3)},Search:function(a){this.setViewPortWidth(320);this.WebOS2Events("stop");this.controller.stopListening(this.controller.stageController.document,"keydown",this.KeypresseventHandler);this.searching=!0;this.IsSet=!1;this.controller.setMenuVisible(Mojo.Menu.viewMenu,!1);this.controller.setMenuVisible(Mojo.Menu.commandMenu,!1);$("searchScrim").show();void 0!=a?(this.controller.get("MainSearchField").value="",this.controller.get("MainSearchField").blur(),this.controller.get("MainSearchField").value=
a,this.controller.get("MainSearchField").blur(),this.controller.get("MainSearchField").focus()):(this.controller.get("MainSearchField").focus(),this.controller.get("MainSearchField").select());a=this.map.getBounds();this.MainAutocomplete.setBounds(a)},SelectedAutocomplete:function(){this.WebOS2Events("start");this.setViewPortWidth(480);this.controller.setMenuVisible(Mojo.Menu.viewMenu,!0);this.controller.setMenuVisible(Mojo.Menu.commandMenu,!0);$("searchScrim").hide();this.searching=!1;this.IsSet=
!0;this.controller.get("MainSearchField").blur();var a;a=this.MainAutocomplete.getPlaces();this.Log("PLACES LENGTH "+a.length);if(1==a.length){a=a[0];try{this.map.fitBounds(a.geometry.viewport)}catch(c){this.map.setZoom(17)}try{var d="";a.address_components&&(d=[a.address_components[0]&&a.address_components[0].short_name||"",a.address_components[1]&&a.address_components[1].short_name||"",a.address_components[2]&&a.address_components[2].short_name||""].join(" "));this.isTouchPad()&&(this.ActualCenter=
a.geometry.location);this.PlaceMarker({position:a.geometry.location,title:a.name,subtitle:d,place:a,popbubble:!0});this.feedMenuModel.items[1].items[1].label=a.name;this.controller.modelChanged(this.feedMenuModel);this.controller.listen(this.controller.stageController.document,"keydown",this.KeypresseventHandler)}catch(f){}}else 1>a.length?this.ShowInfoDialog('"'+this.controller.get("MainSearchField").value+'" '+$L("not found")+"!",$L("ZERO_RESULTS_NEARBY"),$L("OK")):this.PlaceSearchBoxPlaces(a)},
SearchPaste:function(){(function(){var a=this.controller.get("MainSearchField").value;this.controller.get("MainSearchField").value="";this.controller.get("MainSearchField").blur();this.controller.get("MainSearchField").value=a;this.controller.get("MainSearchField").blur();this.controller.get("MainSearchField").focus()}).bind(this).delay(1)},SearchKeypress:function(){this.ns=[];var a=document.getElementsByClassName("pac-container")[0];this.ns.checktimes=0;var c=document.getElementById("MainSearchField");
this.ns.checkTimer&&clearTimeout(this.ns.checkTimer);this.CheckSearchInput(a,c)},DropPin:function(a){this.GeocodeFromLatLng(a)},PlaceDroppedPin:function(a){var c=$L("Approximately: ")+a.formatted_address;a.name=$L("Loc: ")+this.inputstring;a.icon="images/menu-icon-mylocation.png";a.formatted_address=c;a.vicinity=c;this.Log("** MARKER DROP ID %j ***",a.id);this.Log("** MARKER DROP REFERENCE %j ***",a.reference);this.PlaceMarker({position:a.geometry.location,title:this.inputstring,subtitle:c,place:a,
action:this.holdaction,popbubble:!0});this.holdaction=this.inputstring=void 0},CheckSearchInput:function(a,c){""==document.getElementById("MainSearchField").value&&(a.style.display="none");c&&20>this.ns.checktimes&&(""==a.style.display&&(this.ns.checkTimer=null),c&&("none"==a.style.display&&1<this.ns.checktimes)&&(a.style.display="block",a.style.top="44px",a.innerHTML="<div class='pac-item'>"+$L("No results")+"...</div>",this.ns.checkTimer=null),this.ns.checktimes++,this.ns.checkTimer=setTimeout(function(){this.CheckSearchInput(a,
c)}.bind(this),500))},SelectedOriginPlace:function(){this.IsSet=!0;this.origin=this.Originautocomplete.getPlace().geometry.location;""==this.controller.get("DestinationSearchField").value&&this.controller.get("DestinationSearchField").focus()},SelectedDestinationPlace:function(){this.IsSet=!0;this.destination=this.Destinationautocomplete.getPlace().geometry.location;""==this.controller.get("OriginSearchField").value&&this.controller.get("OriginSearchField").focus()},PlaceMarker:function(a){var c=
"";a.icon||(a.icon="Map-Marker-Push-Pin-2-Right-Red-icon.png");var d={url:"images/"+this.ImagePathAdd+a.icon,size:new google.maps.Size(64*this.ImageRatio,64*this.ImageRatio),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(24*this.ImageRatio,48*this.ImageRatio),scaledSize:new google.maps.Size(48*this.ImageRatio,48*this.ImageRatio)},f=new google.maps.Marker({position:a.position,map:this.map,icon:d,animation:google.maps.Animation.DROP,optimized:this.optimizedmarkers,title:"Marker"}),g=
a.place;"droppin"!=a.action&&a.popbubble&&(this.map.setZoom(14),this.map.setCenter(a.position));g.rating&&(c='<div class="rating-container" id="rating-container" style="padding-right: 7px; padding-left: 0px; margin-top: 5px;"><div class="rating_bar"><div id="ratingstar" style="width:'+20*g.rating+'%"></div></div></div>');a.subtitle=g.vicinity||this.getVicinityFromFormattedAddress(g.formatted_address);g.vicinity=g.vicinity||g.formatted_address;var h=new InfoBubble({map:this.map,content:'<div id="bubble" class="phoneytext truncating-text"><div class="truncating-text">'+
a.title+'</div><div class="phoneytext2 truncating-text">'+a.subtitle+"</div>"+c+"</div>",shadowStyle:0,padding:0,backgroundColor:"rgb(57,57,57)",borderRadius:4*this.ImageRatio,arrowSize:10*this.ImageRatio,borderWidth:1,borderColor:"#2c2c2c",disableAutoPan:!0,hideCloseButton:!0,arrowPosition:50,backgroundClassName:"phoney",backgroundClassNameClicked:"phoney-clicked",arrowStyle:2,onClick:function(){f.setAnimation(google.maps.Animation.BOUNCE);this.markerBubbleTap({marker:f,infoBubble:h,title:a.title,
subtitle:a.subtitle,place:g});(function(){f.setAnimation(null)}).bind(this).delay(2)}.bind(this)});this.MayBubblePop=!0;a.popbubble&&function(){this.toggleInfoBubble(h,f)}.bind(this).delay(1);h.id=g.id;f.place=g;f.infoBubble=h;google.maps.event.addListener(f,"click",this.toggleInfoBubble.bind(this,h,f));infoBubbles.push(h);markers.push(f)},toggleInfoBubble:function(a,c){(function(){this.MayBubblePop=!0}).bind(this).delay(0.5);this.Log("You clicked the marker.");!a.isOpen()&&this.MayBubblePop?(a.open(this.map,
c),this.MayBubblePop=!1,this.hideStatusPanel()):this.MayBubblePop&&(a.close(),this.MayBubblePop=!1)},toggleDirectInfoBubble:function(a,c){(function(){this.MayBubblePop=!0}).bind(this).delay(0.5);a.isOpen()||this.hideDirectInfoBubbles();!a.isOpen()&&this.MayBubblePop?(a.open(this.map,c),this.MayBubblePop=!1):this.MayBubblePop&&(a.close(),this.MayBubblePop=!1)},hideInfoBubbles:function(){for(b=0;b<infoBubbles.length;b++)infoBubbles[b].close()},hideDirectInfoBubbles:function(){for(b=0;b<this.DirectinfoBubbles.length;b++)this.DirectinfoBubbles[b].close()},
hideAllVisibileBubbles:function(){var a=[];for(b=0;b<infoBubbles.length;b++)infoBubbles[b].isOpen()&&(infoBubbles[b].close(),a.push(infoBubbles[b]));for(b=0;b<this.DirectinfoBubbles.length;b++)this.DirectinfoBubbles[b].isOpen()&&(this.DirectinfoBubbles[b].close(),a.push(this.DirectinfoBubbles[b]));this.MayBubblePop=!1;return a},showAllVisibileBubbles:function(a){for(b=0;b<a.length;b++)a[b].open()},mapClear:function(){this.Log("CLEARMAP ");for(e=0;e<markers.length;e++)markers[e].place.favorite||(markers[e].setMap(null),
markers.remove(e));for(e=0;e<infoBubbles.length;e++)infoBubbles[e].setMap(null);infoBubbles.length=0;this.clearDirectPoints();this.clearNearbyMarkers();this.directionsDisplay.setMap(null);this.DirectionsButtonModel.label!=$L("Get Directions >")&&(this.DirectionsButtonModel.label=$L("Get Directions >"),this.controller.modelChanged(this.DirectionsButtonModel),$("DirectionsInput").show(),$("DirectionsPanel").hide());this.ChangeCmdMenu("normal");this.DirectStep=0;this.origin=this.MyLocation;this.destination=
null;this.controller.get("OriginSearchField").value=$L("My Location");this.controller.get("DestinationSearchField").value="";this.feedMenuModel.items[1].items[1].label=$L("Google Maps");this.controller.modelChanged(this.feedMenuModel)},clearDirectPoints:function(){for(e=0;e<this.Directmarkers.length;e++)this.Directmarkers[e].setMap(null);for(e=0;e<this.DirectinfoBubbles.length;e++)this.DirectinfoBubbles[e].setMap(null);this.DirectinfoBubbles.length=0;this.Directmarkers.length=0},clearNearbyMarkers:function(){this.markerCluster&&
this.markerCluster.clearMarkers();for(e=0;e<this.Nearbymarkers.length;e++)this.Nearbymarkers[e].setMap(null);for(e=0;e<this.NearbyinfoBubbles.length;e++)this.NearbyinfoBubbles[e].setMap(null);this.NearbyinfoBubbles.length=0;this.Nearbymarkers.length=0},LoadingSpinner:function(a){switch(a){case "start":$("busy-overlay-scrim").show();this.controller.get("LoadingSpinner").mojo.start();break;case "stop":this.controller.get("LoadingSpinner").mojo.stop(),$("busy-overlay-scrim").hide()}},getRegion:function(){var a=
"en_us",a=Mojo.Locale.getCurrentFormatRegion();this.lang=a.substring(0,2);switch(this.lang){case "cz":this.lang="cs"}return this.lang},handleBackSwipe:function(a){this.searching&&(this.setViewPortWidth(480),$("searchScrim").toggle(),this.controller.setMenuVisible(Mojo.Menu.viewMenu,!0),this.controller.setMenuVisible(Mojo.Menu.commandMenu,!0),this.searching=!1,this.KeyWasPressed&&(this.controller.listen(this.controller.stageController.document,"keydown",this.KeypresseventHandler),this.KeyWasPressed=
!1),a.stop());if(this.directing){this.setViewPortWidth(480);try{this.updateDirectionsResponse(this.directionsResponse)}catch(c){this.Log(c)}$("directionsScrim").toggle();this.controller.setMenuVisible(Mojo.Menu.viewMenu,!0);this.controller.setMenuVisible(Mojo.Menu.commandMenu,!0);this.directing=!1;this.KeyWasPressed&&(this.controller.listen(this.controller.stageController.document,"keydown",this.KeypresseventHandler),this.KeyWasPressed=!1);a.stop()}this.WebOS2Events("start")},Keypress:function(a){27!=
a.keyCode&&(13!=a.keyCode&&129!=a.keyCode&&231!=a.keyCode&&!this.debug)&&(this.controller.stopListening(this.controller.stageController.document,"keydown",this.KeypresseventHandler),this.KeyWasPressed=!0,this.Search(),this.controller.get("MainSearchField").blur(),this.controller.get("MainSearchField").focus())},Directions:function(a){this.setViewPortWidth(320);this.isTouchPad()||this.WebOS2Events("stop");this.KeyWasPressed=!0;this.controller.stopListening(this.controller.stageController.document,
"keydown",this.KeypresseventHandler);this.transitTime=new Date;this.setTransitDatePickers(this.transitTime);this.directing=!0;this.IsSet=!1;this.controller.toggleMenuVisible(Mojo.Menu.viewMenu);this.isTouchPad()||this.controller.toggleMenuVisible(Mojo.Menu.commandMenu);$("directionsScrim").toggle();void 0==this.TravelMode&&(this.travel=google.maps.DirectionsTravelMode.DRIVING,this.TravelMode="driving",$("TransitOptions").hide(),$("DriveOptions").show());this.GPSFix&&!this.firstinsertposition?(this.firstinsertposition=
!0,this.origin=this.MyLocation,this.controller.get("OriginSearchField").value=$L("My Location"),this.controller.get("DestinationSearchField").focus()):""==this.controller.get("OriginSearchField").value&&this.controller.get("OriginSearchField").focus();try{a.endAddress&&(this.controller.get("DestinationSearchField").value=a.endAddress,a.endAddress=null),a.startAddress&&(this.controller.get("OriginSearchField").value=a.startAddress,a.startAddress=null)}catch(c){}this.updateDirectListHeight()},DirectType:function(a){this.TravelMode=
a.value;switch(a.value){case "driving":this.travel=google.maps.DirectionsTravelMode.DRIVING;$("TransitOptions").hide();$("DriveOptions").show();break;case "walking":this.travel=google.maps.DirectionsTravelMode.WALKING;$("TransitOptions").hide();$("DriveOptions").hide();break;case "bicycling":this.travel=google.maps.DirectionsTravelMode.BICYCLING;$("TransitOptions").hide();$("DriveOptions").hide();break;case "transit":this.travel=google.maps.DirectionsTravelMode.TRANSIT,$("DriveOptions").hide(),$("TransitOptions").show()}},
GetDirectionsButtonTap:function(){switch(this.DirectionsButtonModel.label){case $L("Get Directions >"):this.controller.get("OriginSearchField").value==$L("My Location")&&(this.origin=this.MyLocation);this.controller.get("DestinationSearchField").value==$L("My Location")&&(this.destination=this.MyLocation);this.LoadingSpinner("start");this.CalcRoute();break;case $L("Update Directions"):this.DirectionsButtonModel.label=$L("Get Directions >"),this.controller.modelChanged(this.DirectionsButtonModel),
$("DirectionsInput").show(),$("DirectionsPanel").hide()}},IsRouted:function(a){a&&(this.DirectionsButtonModel.label=$L("Update Directions"),this.controller.modelChanged(this.DirectionsButtonModel),$("DirectionsInput").hide(),$("DirectionsPanel").show())},SwapDirections:function(){var a=this.origin,c=this.destination,d=this.controller.get("OriginSearchField").value,f=this.controller.get("DestinationSearchField").value;this.origin=c;this.destination=a;this.controller.get("OriginSearchField").value=
f;this.controller.get("DestinationSearchField").value=d},CalcRoute:function(){if(void 0==this.origin||void 0==this.destination)this.LoadingSpinner("stop"),Mojo.Controller.errorDialog($L("Request is not complete, be sure that the Origin and Destination is set properly and try it again."));else{this.routeIndex=0;switch(this.TransitWhichTime){case "departure":this.transitOptions={departureTime:this.transitTime};break;case "arrival":this.transitOptions={arrivalTime:this.transitTime}}var a={origin:this.origin,
destination:this.destination,unitSystem:this.getGoogleUnitSystem(this.Preferences.LengthUnits),provideRouteAlternatives:this.routeAlternatives,durationInTraffic:!0,avoidHighways:this.avoidHighways,avoidTolls:this.avoidTolls,transitOptions:this.transitOptions,travelMode:this.travel};this.directionsService.route(a,function(a,d){d==google.maps.DirectionsStatus.OK?(this.IsRouted(!0),this.clearDirectPoints(),this.WebOSVersion1()&&(a=this.makeFriendly145withmarkers(a)),this.directionsResponse=a,this.DirectionMarkers({start:this.origin,
end:this.destination,start_title:a.routes[this.routeIndex].legs[0].start_address,end_title:a.routes[this.routeIndex].legs[0].end_address}),this.ChangeCmdMenu("directions"),this.MapIdle(),this.directionsDisplay.setDirections(a),this.directionsDisplay.setMap(this.map),this.routeIndex=this.directionsDisplay.getRouteIndex(),this.makeDirectMarkers(a),this.SetTopMenuText(a.routes[this.routeIndex].legs[0].distance.text+"; "+a.routes[this.routeIndex].legs[0].duration.text)):(Mojo.Controller.errorDialog($L(d)),
this.IsRouted(!1),this.MapIdle())}.bind(this))}},makeFriendly145withmarkers:function(a){for(var c=0;c<a.routes.length;c++){a.routes[c].legs[0].start_location=new google.maps.LatLng(a.routes[c].legs[0].start_location.lat,a.routes[c].legs[0].start_location.lng);a.routes[c].legs[0].end_location=new google.maps.LatLng(a.routes[c].legs[0].end_location.lat,a.routes[c].legs[0].end_location.lng);try{a.routes[c].legs[0].via_waypoint[0].location=new google.maps.LatLng(a.routes[c].legs[0].via_waypoint[0].location.lat,
a.routes[c].legs[0].via_waypoint[0].location.lng)}catch(d){}for(var f=0;f<a.routes[c].legs[0].steps.length;f++)a.routes[c].legs[0].steps[f].start_location=new google.maps.LatLng(a.routes[c].legs[0].steps[f].start_location.lat,a.routes[c].legs[0].steps[f].start_location.lng),a.routes[c].legs[0].steps[f].end_location=new google.maps.LatLng(a.routes[c].legs[0].steps[f].end_location.lat,a.routes[c].legs[0].steps[f].end_location.lng),a.routes[c].legs[0].steps[f].start_point=new google.maps.LatLng(a.routes[c].legs[0].steps[f].start_point.lat,
a.routes[c].legs[0].steps[f].start_point.lng),a.routes[c].legs[0].steps[f].end_point=new google.maps.LatLng(a.routes[c].legs[0].steps[f].end_point.lat,a.routes[c].legs[0].steps[f].end_point.lng)}return a},makeDirectMarkers:function(a){this.myRoute=a.routes[this.routeIndex].legs[0]},DirectionMarkers:function(a){this.PlaceDirectionMarker({position:a.start,style:"start",title:a.start_title,subtitle:""});this.PlaceDirectionMarker({position:a.end,style:"end",title:a.end_title,subtitle:""});this.DirectStep=
0},PlaceDirectionMarker:function(a){switch(a.style){case "start":var c="images/bubble/"+this.ImagePathAdd+"flagA.png",d=48*this.ImageRatio,f=[Math.round(23*this.ImageRatio),46*this.ImageRatio];break;case "end":c="images/bubble/"+this.ImagePathAdd+"flagB.png";d=48*this.ImageRatio;f=[Math.round(23*this.ImageRatio),46*this.ImageRatio];break;case "point":c="images/bubble/point.png",d=14,f=[7,7]}c={url:c,size:new google.maps.Size(d,d),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(f[0],
f[1]),scaledSize:new google.maps.Size(d,d)};c=new google.maps.Marker({position:a.position,map:this.map,icon:c,optimized:this.optimizedmarkers,title:"Marker"});a=new InfoBubble({map:this.map,content:'<div id="bubble" class="phoneytextwithoutbutton">'+a.title+'<div class="phoneytext2">'+a.subtitle+"</div></div>",shadowStyle:0,padding:0,backgroundColor:"rgb(57,57,57)",borderRadius:4*this.ImageRatio,arrowSize:10*this.ImageRatio,borderWidth:1,borderColor:"#2c2c2c",disableAutoPan:!1,hideCloseButton:!0,
arrowPosition:50,backgroundClassName:"phoney",backgroundClassNameClicked:"phoney-clicked",arrowStyle:2,onClick:function(){this.Directions()}.bind(this)});google.maps.event.addListener(c,"click",this.toggleDirectInfoBubble.bind(this,a,c));this.DirectinfoBubbles.push(a);this.Directmarkers.push(c)},markerBubbleTap:function(a){this.clickedMarker=a;a=event.originalEvent&&event.originalEvent.target;this.Log("**** Navit installed ****",this.isNavit);this.isNavit||this.debug?this.controller.popupSubmenu({onChoose:this.handlemarkerBubbleTap,
popupClass:"pre3markerpopup",placeNear:a,items:[{iconPath:"images/bubble/info.png",label:$L("Info"),command:"do-marker-info"},{iconPath:"images/street.png",label:$L("Street View"),command:"do-street"},{iconPath:"images/bubble/flagA.png",label:$L("Route from here"),command:"do-origin"},{iconPath:"images/bubble/flagB.png",label:$L("Route to here"),command:"do-destination"},{iconPath:"images/navit_icon.png",label:$L("Route with Navit"),command:"do-navit"},{iconPath:"images/bubble/delete.png",label:$L("Remove"),
command:"do-marker-remove"}]}):this.controller.popupSubmenu({onChoose:this.handlemarkerBubbleTap,popupClass:"pre3markerpopup",placeNear:a,items:[{iconPath:"images/bubble/info.png",label:$L("Info"),command:"do-marker-info"},{iconPath:"images/street.png",label:$L("Street View"),command:"do-street"},{iconPath:"images/bubble/flagA.png",label:$L("Route from here"),command:"do-origin"},{iconPath:"images/bubble/flagB.png",label:$L("Route to here"),command:"do-destination"},{iconPath:"images/bubble/delete.png",
label:$L("Remove"),command:"do-marker-remove"}]})},handlemarkerBubbleTap:function(a){switch(a){case "do-street":this.setStatusPanel($L("Loading StreetView..."));this.StreetView(this.clickedMarker.marker.getPosition());break;case "do-marker-info":this.setStatusPanel($L("Loading marker info..."));this.markerInfo(this.clickedMarker);break;case "do-origin":this.DirectionsButtonModel.label!=$L("Get Directions >")&&(this.DirectionsButtonModel.label=$L("Get Directions >"),this.controller.modelChanged(this.DirectionsButtonModel),
$("DirectionsInput").show(),$("DirectionsPanel").hide());this.origin=this.clickedMarker.marker.getPosition();this.firstinsertposition=!0;this.controller.get("OriginSearchField").value=this.clickedMarker.title;this.controller.get("OriginSearchField").blur();this.Directions();break;case "do-destination":this.DirectionsButtonModel.label!=$L("Get Directions >")&&(this.DirectionsButtonModel.label=$L("Get Directions >"),this.controller.modelChanged(this.DirectionsButtonModel),$("DirectionsInput").show(),
$("DirectionsPanel").hide());this.destination=this.clickedMarker.marker.getPosition();this.controller.get("DestinationSearchField").value=this.clickedMarker.title;this.controller.get("DestinationSearchField").blur();this.Directions();break;case "do-navit":this.openNavit(this.clickedMarker);break;case "do-marker-remove":this.markerRemove(this.clickedMarker)}},openNavit:function(a){this.setStatusPanel($L("Launching Navit..."),5);var c=a.place.name,d=a.marker.getPosition(),a=JSON.stringify(d.lat()),
d=JSON.stringify(d.lng()),a=a.substring(0,a.indexOf(".")+5),d=d.substring(0,d.indexOf(".")+5);1=="0"?(stFile="/media/internal/appdata/org.webosinternals.navit/command.txt",stText='navit.pitch=0;navit.tracking=0;navit.follow_cursor=0;navit.set_center("'+d+" "+a+'");'):(stFile="/media/internal/appdata/org.webosinternals.navit/command.txt",stText='navit.set_destination("'+d+" "+a+'","'+c+'");');writeMode=!1;Mojo.Log.info("Opening Navit adr:%s lng:%s lat:%s type:%s",c,d,a,1);this.request=new Mojo.Service.Request("palm://ca.canucksoftware.filemgr",
{method:"write",parameters:{file:stFile,str:stText,append:writeMode},onSuccess:function(){new Mojo.Service.Request("palm://com.palm.applicationManager",{method:"open",parameters:{id:"org.webosinternals.navit",params:{}}});delete this.request}.bind(this),onFailure:function(){delete this.request;this.Log("Set destination failed");Mojo.Controller.errorDialog("Set destination failed")}.bind(this)})},markerRemove:function(a){a.marker.setMap(null);for(e=0;e<markers.length;e++)a.marker.place.id==markers[e].place.id&&
markers.remove(e);for(e=0;e<this.Nearbymarkers.length;e++)a.marker.place.id==this.Nearbymarkers[e].place.id&&this.Nearbymarkers.remove(e);if(a.infoBubble){a.infoBubble.setMap(null);for(e=0;e<infoBubbles.length;e++)a.marker.place.id==infoBubbles[e].id&&infoBubbles.remove(e)}if(a.marker.place.favorite)for(var c=0;c<Favorites.length;c++)a.marker.place.id==Favorites[c].id&&(Favorites.remove(c),this.addToFavorites(Favorites))},markerInfo:function(a){this.controller.stopListening(this.controller.stageController.document,
"keydown",this.KeypresseventHandler);if(a.place.reference){var c={reference:a.place.reference};this.InfoService=new google.maps.places.PlacesService(this.map);this.InfoService.getDetails(c,function(c,f){if(f==google.maps.places.PlacesServiceStatus.OK){a.place.favorite&&(c.favorite=a.place.favorite);c.id=a.place.id;c.geometry.location=a.place.geometry.location;c.name=a.place.name;try{c.formatted_address.length>a.place.formatted_address.length&&(c.formatted_address=a.place.formatted_address)}catch(g){}this.controller.stageController.pushScene({name:"marker-info",
transition:Mojo.Transition.none},c)}else a.place.geometry.location&&this.controller.stageController.pushScene({name:"marker-info",transition:Mojo.Transition.none},a.place)}.bind(this))}else this.controller.stageController.pushScene({name:"marker-info",transition:Mojo.Transition.none},a.place)},ChangeCmdMenu:function(a){switch(a){case "directions":this.cmdMenuModel.items[1].items=[{icon:"back",command:"back-step",disabled:!0},{label:$L("Minus"),iconPath:"images/zoomout.png",command:"zoomOut"},{label:$L(""),
iconPath:"images/list-view-icon.png",command:"PopMenu"},{label:$L("Plus"),iconPath:"images/zoomin.png",command:"zoomIn"},{icon:"forward",command:"forward-step"}];this.controller.modelChanged(this.cmdMenuModel);this.MayBubblePop=!0;this.toggleDirectInfoBubble(this.DirectinfoBubbles[0],this.Directmarkers[0]);this.cmdMenuStyle=a;break;case "normal":this.cmdMenuModel.items[1].items=[{label:$L("Minus"),iconPath:"images/zoomout.png",command:"zoomOut"},{label:$L(""),iconPath:"images/list-view-icon.png",
command:"PopMenu"},{label:$L("Plus"),iconPath:"images/zoomin.png",command:"zoomIn"}];this.controller.modelChanged(this.cmdMenuModel);this.cmdMenuStyle=a;break;case "imagery":this.cmdMenuModel.items[1].items=[{label:$L("Minus"),iconPath:"images/zoomout.png",command:"zoomOut"},{label:$L(""),iconPath:"images/list-view-icon.png",command:"PopMenu"},{icon:"refresh",command:"imagery-rotate"},{label:$L("Plus"),iconPath:"images/zoomin.png",command:"zoomIn"}],this.controller.modelChanged(this.cmdMenuModel)}},
moveOnRoute:function(a){switch(a){case "forward-step":this.myRoute.steps.length>this.DirectStep+1&&(2<this.Directmarkers.length&&(this.toggleDirectInfoBubble(this.DirectinfoBubbles[2],this.Directmarkers[2]),this.Directmarkers[2].setMap(null),this.DirectinfoBubbles[2].setMap(null),delete this.DirectinfoBubbles[2],delete this.Directmarkers[2],this.DirectinfoBubbles.length--,this.Directmarkers.length--),this.DirectStep++,this.PlaceDirectionMarker({position:this.myRoute.steps[this.DirectStep].start_location,
style:"point",title:this.myRoute.steps[this.DirectStep].instructions,subtitle:""}),this.MayBubblePop=!0,this.toggleDirectInfoBubble(this.DirectinfoBubbles[2],this.Directmarkers[2]));break;case "back-step":0<this.DirectStep&&(2<this.Directmarkers.length&&(this.toggleDirectInfoBubble(this.DirectinfoBubbles[2],this.Directmarkers[2]),this.Directmarkers[2].setMap(null),this.DirectinfoBubbles[2].setMap(null),delete this.DirectinfoBubbles[2],delete this.Directmarkers[2],this.DirectinfoBubbles.length--,this.Directmarkers.length--),
this.DirectStep--,this.PlaceDirectionMarker({position:this.myRoute.steps[this.DirectStep].start_location,style:"point",title:this.myRoute.steps[this.DirectStep].instructions,subtitle:""}),this.MayBubblePop=!0,this.toggleDirectInfoBubble(this.DirectinfoBubbles[2],this.Directmarkers[2]))}switch(this.DirectStep){case 0:this.cmdMenuModel.items[1].items[0].disabled=!0;this.cmdMenuModel.items[1].items[4].disabled=!1;this.controller.modelChanged(this.cmdMenuModel);break;case 1:this.cmdMenuModel.items[1].items[0].disabled=
!1;this.cmdMenuModel.items[1].items[4].disabled=!1;this.controller.modelChanged(this.cmdMenuModel);break;case this.myRoute.steps.length-2:this.cmdMenuModel.items[1].items[0].disabled=!1;this.cmdMenuModel.items[1].items[4].disabled=!1;this.controller.modelChanged(this.cmdMenuModel);break;case this.myRoute.steps.length-1:this.cmdMenuModel.items[1].items[0].disabled=!1,this.cmdMenuModel.items[1].items[4].disabled=!0,this.controller.modelChanged(this.cmdMenuModel)}},MapHeadingRotate:function(a){var c=
-a.heading;this.NewTilesHere&&(this.ContainerToRotate=document.getElementById("map_canvas").firstChild.firstChild,this.getElementsToScale(),this.NewTilesHere=!1);void 0!=this.previousheading&&0!=c&&(c=(c+this.previousheading)/2);360<c&&(c-=360);this.ContainerToRotate.style["-webkit-transform"]="translateY("+(8.3<a.velocity?100*this.ScreenRoughRatio:8.3>=(2.8<=a.velocity)?a.velocity/0.083*this.ScreenRoughRatio:0)+"px) rotate3d(0,0,1,"+c.toString()+"deg)";this.ContainerToRotate.style.overflow="visible !important;";
for(a=0;a<this.elementsToScale.length;a++)this.elementsToScale[a].style["-webkit-transform"]="rotate3d(0,0,1,"+(-c).toString()+"deg) ";this.compassRotate(c);this.previousheading=c},compassRotate:function(a){$("compass_rotate").style["-webkit-transform"]="rotate3d(0,0,1,"+a.toString()+"deg) "},SetTopMenuText:function(a){this.feedMenuModel.items[1].items[1].label=a;this.controller.modelChanged(this.feedMenuModel)},GetHeadingFromLatLng:function(a,c){"undefined"===typeof Number.prototype.toRad&&(Number.prototype.toRad=
function(){return this*Math.PI/180});"undefined"===typeof Number.prototype.toDeg&&(Number.prototype.toDeg=function(){return 180*this/Math.PI});var d=a.lat(),f=a.lng(),g=c.lat(),h=c.lng();(g-d).toRad();h=(h-f).toRad();d=d.toRad();g=g.toRad();f=Math.sin(h)*Math.cos(g);d=Math.cos(d)*Math.sin(g)-Math.sin(d)*Math.cos(g)*Math.cos(h);return Math.atan2(f,d).toDeg()},FullscreenOff:function(a){this.Preferences.Fullscreen=!a;this.PrefsCookie.put(this.Preferences);window.PalmSystem.enableFullScreenMode(this.Preferences.Fullscreen)},
PlaceSearchBoxPlaces:function(a){this.feedMenuModel.items[1].items[1].label=this.controller.get("MainSearchField").value+$L(": found  ")+a.length+$L(" places");this.controller.modelChanged(this.feedMenuModel);this.clearNearbyMarkers();for(var c,d=0;d<a.length;d++)c=a[d],c.distance=google.maps.geometry.spherical.computeDistanceBetween(this.MyLocation,c.geometry.location),this.PlaceNearbyMarker(c);this.markerCluster=new MarkerClusterer(this.map,this.Nearbymarkers);this.MarkersFitBounds(this.Nearbymarkers);
this.controller.listen(this.controller.stageController.document,"keydown",this.KeypresseventHandler)},SearchNearbyPlaces:function(a,c){var d={location:this.map.getCenter(),radius:c,query:a};this.NearbyService=new google.maps.places.PlacesService(this.map);this.NearbyService.textSearch(d,function(a,c){if(c==google.maps.places.PlacesServiceStatus.OK)if(1<a.length){this.feedMenuModel.items[1].items[1].label=d.query+$L(" within ")+d.radius+$L("m");this.controller.modelChanged(this.feedMenuModel);this.clearNearbyMarkers();
for(var h=0;h<a.length;h++){var k=a[h];k.distance=google.maps.geometry.spherical.computeDistanceBetween(d.location,k.geometry.location);this.PlaceNearbyMarker(a[h])}this.MarkersFitBounds(this.Nearbymarkers);this.markerCluster=new MarkerClusterer(this.map,this.Nearbymarkers)}else 1==a.length&&(this.PlaceMarker({position:a[0].geometry.location,title:a[0].name,subtitle:a[0].formatted_address,place:a[0],popbubble:!0}),this.feedMenuModel.items[1].items[1].label=a[0].name);else this.ShowInfoDialog('"'+
d.query+'"'+$L(" not found!"),$L(c+"_NEARBY"),$L("OK"))}.bind(this));this.controller.listen(this.controller.stageController.document,"keydown",this.KeypresseventHandler)},PlaceNearbyMarker:function(a){var c={url:"images/"+this.ImagePathAdd+"MapMarker_Ball__Red.png",size:new google.maps.Size(48*this.ImageRatio,48*this.ImageRatio),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(23*this.ImageRatio,47*this.ImageRatio),scaledSize:new google.maps.Size(48*this.ImageRatio,48*this.ImageRatio)},
c=new google.maps.Marker({map:this.map,icon:c,optimized:this.optimizedmarkers,animation:google.maps.Animation.DROP,position:a.geometry.location});a.infoBubble=void 0;google.maps.event.addListener(c,"click",this.toggleNearbyInfoBubble.bind(this,c,a));this.MayNearbyBubblePop=!0;c.place=a;c.place.vicinity=c.place.vicinity||this.getVicinityFromFormattedAddress(c.place.formatted_address);this.Nearbymarkers.push(c)},toggleNearbyInfoBubble:function(a,c){(function(){this.MayNearbyBubblePop=!0}).bind(this).delay(0.5);
var d="<div class='phoneytext2'>("+(c.distance/1E3).toFixed(2)+"km) </div>";c.rating&&(d="<div class='phoneytext2' style='height: 18px; margin-top: 7px;'>("+(c.distance/1E3).toFixed(2)+"km) </div>",d='<div class="rating-container" id="rating-container" style="padding-right: 7px; padding-left: 0px; margin-top: 5px; float:left;"><div class="rating_bar"><div id="ratingstar" style="width:'+20*c.rating+'%"></div></div></div>'+d);if(void 0==c.infoBubble){c.vicinity=c.vicinity||this.getVicinityFromFormattedAddress(c.formatted_address);
var f=new InfoBubble({map:this.map,content:'<div id="bubble" class="phoneytext truncating-text"><div class="truncating-text">'+c.name+'</div><div class="phoneytext2 truncating-text">'+c.vicinity+"</div>"+d+"</div>",shadowStyle:1,padding:0,backgroundColor:"rgb(57,57,57)",borderRadius:4,arrowSize:10,borderWidth:1,borderColor:"#2c2c2c",disableAutoPan:!1,hideCloseButton:!0,arrowPosition:50,backgroundClassName:"phoney",backgroundClassNameClicked:"phoney-clicked",arrowStyle:2,onClick:function(){this.markerBubbleTap({marker:a,
infoBubble:f,title:c.name,subtitle:c.vicinity,place:c})}.bind(this)});c.infoBubble=f;c.infoBubble.open(this.map,a);f.id=c.id;this.NearbyinfoBubbles.push(f)}else!c.infoBubble.isOpen()&&this.MayNearbyBubblePop?c.infoBubble.open(this.map,a):(c.infoBubble.close(),c.infoBubble.setMap(null),this.Log("ID:",c.id)),this.MayNearbyBubblePop=!1},getVicinityFromFormattedAddress:function(a){return a.substring(0,a.lastIndexOf(","))},MarkersFitBounds:function(a){for(var c=[],d=0;d<a.length;d++)c.push(a[d].position);
for(var a=new google.maps.LatLngBounds,d=0,f=c.length;d<f;d++)a.extend(c[d]);this.map.fitBounds(a)},getMarkerFromList:function(a){this.blockTPPan=!0;for(var c=0;c<this.Nearbymarkers.length;c++)this.Nearbymarkers[c].place.relevance=c;for(c=0;c<markers.length;c++)markers[c].place.relevance=c,markers[c].place.distance=google.maps.geometry.spherical.computeDistanceBetween(this.MyLocation,markers[c].place.geometry.location);this.MyLocationMarker=[];this.MyLocationMarker.place=[];this.MyLocationMarker.place.geometry=
[];this.MyLocationMarker.place.geometry.location=this.MyLocation;this.MyLocationMarker.place.name=$L("My Location");this.MyLocationMarker.place.vicinity="";MarkersArray.action=a;MarkersArray[0]=this.Nearbymarkers;MarkersArray[1]=markers;MarkersArray[2]=this.MyLocationMarker;MarkersArray[3]=Favorites;this.controller.stageController.pushScene({name:"markers-list",transition:Mojo.Transition.none},MarkersArray,this.Preferences,this.gps)},OriginMarkersButtonTap:function(){this.getMarkerFromList("origin")},
DestinationMarkersButtonTap:function(){this.getMarkerFromList("destination")},GeocodeFromLatLng:function(a){(new google.maps.Geocoder).geocode({latLng:a},function(c,d){if(d==google.maps.GeocoderStatus.OK){if(c[0])return this.Log("** ADRESA *** %j",c[0].formatted_address),c[0].geometry.location=a,c[0].id=Math.floor(1E12*Math.random()+1),this.PlaceDroppedPin(c[0]),c[0]}else this.Log("Geocoder failed due to: ",d)}.bind(this))},checkConnectivity:function(a){this.controller.serviceRequest("palm://com.palm.connectionmanager",
{method:"getstatus",parameters:{},onSuccess:function(c){var d=c.wifi,f=c.wan;c.isInternetConnectionAvailable&&("connected"===d.state||"connected"===f.state)?a&&a():this.controller.showAlertDialog({onChoose:this.closeApp,title:$L("No Internet Connection"),message:$L("This application requires internet connection. Please close the application and try it later when the connection will be available."),choices:[{label:$L("Acknowledge"),value:"ok",type:"dismiss"}]})}.bind(this),onFailure:function(){}.bind(this)})},
MapHold:function(a){this.setStatusPanel($L("Dropping a pin..."));a=new google.maps.Point(a.down.x,a.down.y);a=this.overlay.getProjection().fromContainerPixelToLatLng(a);this.inputstring=a.toUrlValue(4);this.setTopBarText(this.inputstring);this.holdaction="droppin";this.DropPin(a)},setTopBarText:function(a){this.feedMenuModel.items[1].items[1].label=a;this.controller.modelChanged(this.feedMenuModel)},checkAllPreferences:function(a){for(i in DefaultPreferences)void 0==a[i]&&(a[i]=DefaultPreferences[i],
this.Log("** SET NON EXIST PREFERENCE TO THEIR DEAFULT VALUE *** %j",a[i]),this.PrefsCookie.put(a))},closeApp:function(){this.controller.window.close()},setLocalizedHTML:function(){document.getElementById("OriginText").innerHTML='<img src="images/bubble/flagA.png" width="24" height="24" >'+$L("Origin:");document.getElementById("DestinationText").innerHTML='<img src="images/bubble/flagB.png" width="24" height="24">'+$L("Destination:");document.getElementById("HintText").innerHTML=$L("<b>Hint:</b> Just type what you need and press Enter or select some suggestion. It allows you to perform a text-based geographic search.<br>Example 1: '<i>pizza</i>' find nearest pizza from map center within current map bounds<br>Example 2: '<i>hotel in Prague</i>' find hotels in the Prague city");
document.getElementById("RouteAlternativesText").innerHTML=$L("Provide route alternatives");document.getElementById("AvoidHighwaysText").innerHTML=$L("Avoid highways");document.getElementById("AvoidTollsText").innerHTML=$L("Avoid tolls");document.getElementById("TransitDateLabel").innerHTML=$L("Date")},setStatusPanel:function(a,c){$("status-panel-text").innerHTML="";$("status-panel-text").innerHTML=a;$("status-panel").style["-webkit-transition-duration"]="0s";$("status-panel").addClassName("active");
try{this.controller.get("StatusPanelSpinner").mojo.start()}catch(d){}void 0!=c&&0<c&&function(){this.hideStatusPanel()}.bind(this).delay(c)},hideStatusPanel:function(){this.controller.get("StatusPanelSpinner").mojo.stop();$("status-panel").style["-webkit-transition-duration"]="1s";$("status-panel").removeClassName("active")},OverlayComplete:function(){this.Log("** overlay *** %j")},getFavorites:function(){this.setStatusPanel($L("Loading Favorites from database..."));db.get("Favorites",this.dbGetOK.bind(this),
this.dbGetFail.bind(this))},setFavorites:function(a){for(var c=0;c<a.length;c++)a[c].geometry.location=new google.maps.LatLng(a[c].geometry.favlat,a[c].geometry.favlng),this.PlaceMarker({position:a[c].geometry.location,title:a[c].name,subtitle:a[c].formatted_address,place:a[c],icon:"Map-Marker-Push-Pin-2-Right-Red-icon-fav.png",popbubble:!1});Favorites=a},dbGetOK:function(a){"Loading Favorites from database..."==$("status-panel-text").innerHTML&&this.hideStatusPanel();"{}"==Object.favorites||null===
a?Mojo.Log.warn("Retrieved empty or null list from Favorites DB"):(this.Log("Retrieved favorites from DB"),this.setFavorites(a))},dbGetFail:function(a,c){Mojo.Log.warn("Database get error (#",c.message,") - can't save favorites list. Will need to reload on next use.");Mojo.Controller.errorDialog("Database save error (#"+c.message+") - can't save favorites list. Will need to reload on next use.")},addToFavorites:function(){db.add("Favorites",Favorites,this.dbAddOK.bind(this),this.dbAddFail.bind(this))},
dbAddOK:function(){this.Log("Favorite saved OK")},dbAddFail:function(a,c){Mojo.Log.warn("Database save error (#",c.message,") - can't save favorites list. Will need to reload on next use.");Mojo.Controller.errorDialog("Database save error (#"+c.message+") - can't save favorites list. Will need to reload on next use.")},setViewPortWidth:function(a){if(this.isPre3()){this.ImageRatio=480==a?1.5:1;var c=document.getElementsByTagName("meta");for(cnt=0;cnt<c.length;cnt++){var d=c[cnt];"viewport"==d.getAttribute("name")&&
d.setAttribute("content","width="+a+"px; initial-scale=2.0, minimum-scale=1.0, maximum-scale=3.0, user-scalable=yes, height=device-height")}}},activateWindow:function(){this.Log("..................Maximized State");this.blockGPSFix=!1;this.startTracking()},deactivateWindow:function(){this.Log("..................Minimized State");this.blockGPSFix=!0;this.stopTracking()},firstGPSfix:function(){this.Log("Getting location...");this.firstFixHandle=this.controller.serviceRequest("palm://com.palm.location",
{method:"getCurrentPosition",parameters:{maximumAge:5,accuracy:3,responseTime:1},onSuccess:this.firstFixSuccess.bind(this),onFailure:function(a){this.Log("getCurrentPosition failure, results=",JSON.stringify(a))}})},startTracking:function(){this.trackingHandle||(this.trackingHandle=this.controller.serviceRequest("palm://com.palm.location",{method:"startTracking",parameters:{subscribe:!0},onSuccess:this.gpsUpdate.bind(this),onFailure:function(a){this.Log("startTracking failure, results=",JSON.stringify(a))}}))},
stopTracking:function(){this.trackingHandle&&(this.trackingHandle.cancel(),this.trackingHandle=null)},compassTap:function(){switch($("compass").className){case "":this.activeCompass();break;case "active":this.inactiveCompass(),this.setDefaultMyLocMarker()}},compassTapHold:function(a){a.stop();this.controller.popupSubmenu({onChoose:this.handlecompassTapHold,popupClass:"pre3maptype",placeNear:a.originalEvent&&a.originalEvent.target,items:[{secondaryIconPath:"",label:$L("Facing cone"),command:""},{secondaryIconPath:"",
label:$L("Rotate map"),command:""}]})},handlecompassTapHold:function(){},compassHandler:function(a){this.haveCompass||(this.initiateCompass(),this.haveCompass=!0,this.compassactive=!1);var c=void 0,c=Math.round(a.magHeading);void 0!=c&&void 0!=c&&(360<c&&(c-=360),$("needle").style["-webkit-transform"]="rotate3d(0,0,1,-"+(c+this.idleNeedleDeg)+"deg)",this.compassactive&&this.setScoutMarker(c))},initiateCompass:function(){this.Log(" ** Compass capable device detected ** ");$("compass").show();$("compass_rotate").show();
this.controller.stopListening(document,"compass",this.compassHandler)},activeCompass:function(){this.blockScreenTimeout(!0);this.controller.listen(document,"compass",this.compassHandler);$("compass").addClassName("active");$("compass").style["-webkit-transform"]="scale(1)";$("needle").show();this.compassactive=!0},inactiveCompass:function(){this.controller.stopListening(document,"compass",this.compassHandler);$("compass").removeClassName("active");$("compass").style["-webkit-transform"]="scale(0.5)";
$("needle").hide();this.blockScreenTimeout(!1);this.compassactive=!1},setScoutMarker:function(a){337.5<a&&(a=0);var a=Math.round(16/(360/a)),a=String("0"+a).slice(-2),c=Math.round(21*this.ImageRatio),d=Math.round(42*this.ImageRatio),a={url:"images/1.5/blue_arrow/sprite_rotation"+a+".png",size:new google.maps.Size(65,65),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(c,c),scaledSize:new google.maps.Size(d,d)};this.MyLocMarker.setIcon(a)},setDefaultMyLocMarker:function(){var a=this.isPre3()?
{url:"images/1.5/blue_dot_on.png",size:new google.maps.Size(64,64),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(32,32),scaledSize:new google.maps.Point(64,64)}:{url:"images/blue_dot_on.png",size:new google.maps.Size(42,42),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(21,21)};this.MyLocMarker.setIcon(a)},blockScreenTimeout:function(a){this.controller.stageController.window.PalmSystem.setWindowProperties({blockScreenTimeout:a})},pulseDot:function(a){try{if(!this.blockpulse){var c=
this.overlay.getProjection().fromLatLngToContainerPixel(a);c.x=Math.round(c.x-25);c.y=Math.round(c.y-25);document.getElementById("pulse").setAttribute("style","margin: "+c.y.toString()+"px 0 0 "+c.x.toString()+"px;");$("pulse").show();this.blockpulse=!0;(function(){$("pulse").hide();this.blockpulse=!1}).bind(this).delay(2)}}catch(d){}},TimePickerRadio:function(a){this.TransitWhichTime=a.value},TransitPicker:function(a){a=new Date(a.value);this.transitTime.setHours(a.getHours());this.transitTime.setMinutes(a.getMinutes());
this.transitTime.setSeconds(a.getSeconds());this.Log(this.transitTime)},pickDateKalendae:function(a){a.stop();this.controller.get("KalendaeDrawer").mojo.setOpenState(!0)},handleKalendaeDate:function(){var a=this.kalendae.getSelected(),c=this.kalendae.getSelectedAsDates();this.Log("Picked date: ",a);a=new Date(c);this.transitTime.setDate(a.getDate());this.transitTime.setMonth(a.getMonth());this.transitTime.setFullYear(a.getFullYear());this.controller.get("KalendaeDrawer").mojo.setOpenState(!1);this.setTransitDatePickers(this.transitTime)},
handleRouteAlternatives:function(a){this.routeAlternatives=a.value},handleAvoidHighways:function(a){this.avoidHighways=a.value},handleAvoidTolls:function(a){this.avoidTolls=a.value},updateDirectionsResponse:function(a){this.routeIndex!=this.directionsDisplay.getRouteIndex()&&(this.routeIndex=this.directionsDisplay.getRouteIndex(),this.DirectStep=0,this.clearDirectPoints(),this.DirectionMarkers({start:this.origin,end:this.destination,start_title:a.routes[this.routeIndex].legs[0].start_address,end_title:a.routes[this.routeIndex].legs[0].end_address}),
this.makeDirectMarkers(a),this.SetTopMenuText(a.routes[this.routeIndex].legs[0].distance.text+"; "+a.routes[this.routeIndex].legs[0].duration.text))},setTransitDatePickers:function(a){$("TransitDateField").innerHTML=a.getDate()+"."+(a.getMonth()+1)+"."+a.getFullYear();this.TransitDateModel.time=a;this.controller.modelChanged(this.TransitDateModel)},updateDirectListHeight:function(){if(this.isTouchPad()){var a=Math.round(0.84*this.controller.window.innerHeight)+"px";document.getElementById("DirectionsPanelScroller").style.maxHeight=
"620px";this.optimizedmarkers=!0}else a=Math.round(0.74*this.controller.window.innerHeight)+"px",document.getElementById("DirectionsPanelScroller").style.maxHeight=a,document.getElementById("DirectionsOptionsScroller").style.maxHeight=a,this.optimizedmarkers=!1,this.Log("INNER HEIGHT ",this.controller.window.innerHeight)},MapTap:function(a){switch(a.count){case 2:this.setStatusPanel($L("Zooming in...")),this.blockGPSFix=!0,a=new google.maps.Point(a.down.x,a.down.y),a=this.overlay.getProjection().fromContainerPixelToLatLng(a),
this.map.panTo(a),this.map.setZoom(this.map.getZoom()+1)}},handleCmdMenuHold:function(){},getGoogleUnitSystem:function(a){switch(a){case "metric":return google.maps.UnitSystem.METRIC;case "imperial":return google.maps.UnitSystem.IMPERIAL;case "fahrenheit":return google.maps.weather.TemperatureUnit.FAHRENHEIT;case "celsius":return google.maps.weather.TemperatureUnit.CELSIUS}},getVelocityFromGPS:function(a){switch(this.Preferences.LengthUnits){case "metric":return Math.round(3.6*a)+" km/h";case "imperial":return Math.round(2.23693629*
a)+" mph"}},handleForwardSwipe:function(){this.Log("** Forward ***");this.searching&&this.SearchNearbyPlaces(document.getElementById("MainSearchField").value,1E3)},ShowInfoDialog:function(a,c,d){this.controller.showAlertDialog({onChoose:function(){},title:a,message:c,choices:[{label:d,value:""}]})},streetLayer:function(a){switch(a){case !0:a={getTileUrl:function(a,d){return"https://mts2.google.com/mapslt?lyrs=svv&x="+a.x+"&y="+a.y+"&z="+d+"&w=256&h=256&hl=en&style=40,18"},tileSize:new google.maps.Size(256,
256),isPng:!0,opacity:1};a=new google.maps.ImageMapType(a);this.map.overlayMapTypes.setAt(2,a);break;case !1:this.map.overlayMapTypes.setAt(2,null)}},streetSelect:function(){this.streetLayer(!0);this.setStatusPanel($L("Tap on the desired street."));this.StreetMapTapEventHandler=this.StreetMapTap.bindAsEventListener(this);Mojo.Event.listen(this.MapTap,Mojo.Event.tap,this.StreetMapTapEventHandler)},StreetMapTap:function(a){var c=new google.maps.Point(a.down.x,a.down.y),c=this.overlay.getProjection().fromContainerPixelToLatLng(c);
5>Math.abs(a.down.x-a.up.x)&&5>Math.abs(a.down.y-a.up.y)&&(Mojo.Event.stopListening(this.MapTap,Mojo.Event.tap,this.StreetMapTapEventHandler),this.streetLayer(!1),this.StreetView(c))},updateMarkers:function(){this.setStatusPanel($L("Updating markers..."));for(var a=[],c=0;c<MarkersArray.length;c++)for(var d=0;d<MarkersArray[c].length;d++)!0==MarkersArray[c][d].tobedeleted&&(this.Log("REMOVING: %j",MarkersArray[c][d].place.id),a.marker=MarkersArray[c][d],a.infoBubble=MarkersArray[c][d].infoBubble,
this.markerRemove(a),d=-1);for(e=0;e<this.NearbyinfoBubbles.length;e++)this.NearbyinfoBubbles[e].setMap(null);this.hideStatusPanel()},ImageryRotate:function(){this.imageryHeading-=90;this.map.setHeading(this.imageryHeading)},handleLaunch:function(a){var c={};try{a.target&&(c=this.parseTargetOrQuery(a),this.Log("TARGET: Parsed params: %j",c)),a.query&&(c.query=a.query,this.Log("QUERY: Parsed params: %j",c)),a.address&&(c.address=a.address,this.Log("ADDRESS: Parsed params: %j",c)),a.zoom&&(c.zoom=a.zoom,
this.Log("ZOOM: Parsed params: %j",c)),a.mapType&&(c.mapType=a.mapType,this.Log("MAPTYPE: Parsed params: %j",c)),a.location&&(c.location=a.location,this.Log("LOCATION: Parsed params: %j",c)),a.route&&(c.route=a.route,this.Log("ROUTE: Parsed params: %j",c)),this.LoadApiModel.spinning?this.parsedParams=c:this.launchParamsAction(c)}catch(d){Mojo.Controller.errorDialog($L("Wrong cross app parameters")),this.Log(d)}},launchParamsAction:function(a){a.address&&this.Search(a.address);a.route&&this.Directions(a.route);
a.zoom&&this.map.setZoom(a.zoom)},parseTargetOrQuery:function(a){var c={};a.query&&a.query.match(/@-?\d+\.\d+,-?\d+\.\d+$/)&&(c.query=a.query.replace(/@-?\d+\.\d+,-?\d+\.\d+$/,""));if(a.target){var d=decodeURIComponent(a.target);d.match(/^mapto:\/*/)&&this.Preferences.MaptoOverride&&(c.address=d.replace(/^mapto:\/*/,""));d.match(/^mapto:\/*/)&&!this.Preferences.MaptoOverride&&(c.route={startAddress:"",endAddress:d.replace(/^mapto:\/*/,"")});d.match(/^maploc:\/*/)&&(c.address=d.replace(/^maploc:\/*/,
""));d.match(/^(http|https):\/\/maps\.google\./i)&&(d=new GoogleURL(d),d.search&&(c.query=d.search),d.coordinates&&(c.coordinates=d.coordinates),d.near&&(c.near=d.near),d.routeRequest&&(c.route={startAddress:d.routeRequest.start,endAddress:d.routeRequest.end}))}a.route&&!a.route.startAddress&&(c.route.startAddress="");a.route&&!a.route.endAddress&&(c.route.endAddress="");return c},getElementsToScale:function(){this.TilesContainer=document.getElementById("map_canvas").firstChild.firstChild;this.elementsToScale=
[];this.allInfoBubblesToScale=document.getElementsByClassName("infobubble");for(var a=0;a<this.allInfoBubblesToScale.length;a++)this.allInfoBubblesToScale[a].style.display="none";for(var a=this.TilesContainer.getElementsByTagName("IMG"),c=0;c<a.length;c++)if(-1==a[c].src.indexOf("googleapis")&&-1==a[c].src.indexOf("maps.")&&-1==a[c].src.indexOf("openstreetmap.org")&&-1==a[c].src.indexOf("sprite")&&-1==a[c].id.indexOf("NoTrans")&&-1==a[c].src.indexOf("m@155076273,transit")&&-1==a[c].src.indexOf("blue_dot")){a[c].parentNode.style.overflow=
"visible !important;";if(-1!=a[c].src.indexOf("Marker")||-1!=a[c].src.indexOf("flag"))a[c].style["-webkit-transform-origin"]="50% 100%";this.elementsToScale.push(a[c])}},removeTransforms:function(){for(var a=0;a<this.elementsToScale.length;a++)this.elementsToScale[a].style["-webkit-transform"]="",this.elementsToScale[a].style["-webkit-transition"]=""},checkNavit:function(){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4==a.readyState){if(200==a.status)return this.isNavit=!0,this.Log("**** Navit installed ****"),
!0;this.isNavit=!1;this.Log("**** Navit is not installed ****")}}.bind(this);a.open("HEAD","/media/internal/appdata/org.webosinternals.navit/navit.xml",!0);a.send()},changecss:function(a,c,d){for(var f,g=0;g<document.styleSheets.length;g++)try{document.styleSheets[g].insertRule(a+" { "+c+": "+d+"; }",document.styleSheets[g][f].length)}catch(h){try{document.styleSheets[g].addRule(a,c+": "+d+";")}catch(k){try{document.styleSheets[g].rules?f="rules":document.styleSheets[g].cssRules&&(f="cssRules");for(var j=
0;j<document.styleSheets[g][f].length;j++)if(document.styleSheets[g][f][j].selectorText==a&&document.styleSheets[g][f][j].style[c]){document.styleSheets[g][f][j].style[c]=d;break}}catch(l){}}}},fireEnterOnElement:function(a){var c=document.createEvent("KeyboardEvent");c.initKeyboardEvent("keydown",!0,!0,window,!1,!1,!1,!1,"Q",0);a.dispatchEvent(c)},fireTouchOnMap:function(a){try{var c=document.elementFromPoint(a.down.x,a.down.y);this.Log(c);var d=document.createEvent("UIEvent");d.initUIEvent("touchstart",
!0,!0);d.view=window;d.altKey=!1;d.ctrlKey=!1;d.shiftKey=!1;d.metaKey=!1;c.dispatchEvent(d)}catch(f){this.Log(f)}},Log:function(a,c){this.debug&&Mojo.Log.info(a,c)},Debug:function(){this.handleForwardSwipe()}};
